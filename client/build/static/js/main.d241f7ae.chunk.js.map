{"version":3,"sources":["assets/icons/logo.svg","assets/icons/tools sync /^/.*/.svg$","assets/icons/tools/circle.svg","assets/icons/tools/drag.svg","assets/icons/tools/ellipse.svg","assets/icons/tools/erase.svg","assets/icons/tools/line.svg","assets/icons/tools/pencil.svg","assets/icons/tools/rect.svg","assets/icons/tools/text.svg","assets/icons/tools/zoom.svg","assets/icons/controls sync /^/.*/.svg$","assets/icons/controls/camera.svg","assets/icons/controls/download.svg","assets/icons/controls/file.svg","assets/icons/controls/info.svg","assets/icons/controls/invite.svg","assets/icons/controls/microphone.svg","assets/scripts/login.js","assets/config/endpoints.js","components/header/header.jsx","components/table/table.jsx","views/Start/Start.jsx","assets/scripts/board/path-data-polyfill.js","assets/scripts/board/toolsScript.js","assets/scripts/board/board.js","assets/scripts/webRTC.js","components/tools/tools.jsx","components/controls/controls.jsx","components/modal/modal.jsx","components/backdrop/backdrop.js","components/board/board.jsx","views/Room/Room.jsx","App.js","serviceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","map","./circle.svg","./drag.svg","./ellipse.svg","./erase.svg","./line.svg","./pencil.svg","./rect.svg","./text.svg","./zoom.svg","webpackContext","req","id","webpackContextResolve","e","Error","code","keys","Object","resolve","./camera.svg","./download.svg","./file.svg","./info.svg","./invite.svg","./microphone.svg","login","props","socket","on","data","newList","myBoards","addBoard","endpoints","prod","dev","header","logoUrl","require","react_default","a","createElement","className","href","dashboardUrl","src","alt","onClick","create","table","tableItems","list","boardList","sort","b","date","time","length","board","index","itemText","concat","key","Link","to","string","Start","state","userData","firstName","lastName","uid","password","params","queryString","parse","window","location","search","io","this","addBoardToList","bind","emit","setState","components_header_header","createBoard","components_table_table","Component","pathPolyfill","SVGPathElement","prototype","getPathData","setPathData","commandsMap","Z","M","L","C","Q","A","H","V","S","T","z","m","l","c","q","h","v","s","t","Source","_string","_currentIndex","_endIndex","_prevCommand","_skipOptionalSpaces","isIE","navigator","userAgent","indexOf","parseSegment","char","command","values","cmd","toUpperCase","_parseNumber","_parseArcFlag","type","hasMoreData","peekSegmentType","initialCommandIsMoveTo","_isCurrentSpace","_skipOptionalSpacesOrDelimiter","exponent","integer","frac","decimal","sign","expsign","startIndex","startIntPartIndex","scanIntPartIndex","multiplier","charAt","number","Math","pow","flag","flagChar","parsePathDataString","source","pathData","pathSeg","push","setAttribute","removeAttribute","$cachedPathData","Symbol","$cachedNormalizedPathData","clonePathData","seg","Array","slice","call","reducePathData","reducedPathData","lastType","lastControlX","lastControlY","currentX","currentY","subpathX","subpathY","forEach","x","y","x1","y1","x2","y2","cx1","cy1","cx2","cy2","r1","abs","r2","angle","largeArcFlag","sweepFlag","arcToCubicCurves","_recursive","degrees","f1","f2","cx","cy","rotate","angleRad","cos","sin","PI","p1","p2","sqrt","r1Pow","r2Pow","left","right","k","asin","parseFloat","toFixed","df","f2old","x2old","y2old","c1","s1","c2","s2","tan","hx","hy","m1","m2","m3","m4","curves","i","r3","curve","name","value","options","normalize","getAttribute","normalizedPathData","absolutizedPathData","absolutizePathData","d","join","SVGRectElement","baseVal","width","height","rx","hasAttribute","ry","filter","SVGCircleElement","r","SVGEllipseElement","SVGLineElement","SVGPolylineElement","points","numberOfItems","point","getItem","SVGPolygonElement","toolScript","Tools","curLineId","lastTime","performance","now","PointMessage","parent","continueLine","evt","drawAndSend","preventDefault","renderingLine","dist","hypot","pathDataCache","svg","createLine","lineData","line","getElementById","createSVGElement","color","size","max","min","opacity","appendChild","add","listeners","press","generateUID","getColor","getSize","getOpacity","move","release","draw","console","error","pts","nbr","npoint","prev_values","ante_values","prev_x","prev_y","ante_x","ante_y","vectx","vecty","norm","dist1","dist2","addPoint","UpdateMessage","updateLine","curId","curUpdate","createShape","shape","updateShape","erasing","msg","erase","target","touch","touches","document","elementFromPoint","clientX","clientY","elem","removeChild","input","curText","sentText","lastSending","drawCurText","blur","removeEventListener","textChangeHandler","startEdit","parentNode","focus","addEventListener","which","txt","clearTimeout","timeout","setTimeout","tagName","parseInt","textContent","isLocal","fieldData","createTextField","textField","text","updateText","boardId","curTool","boardName","setScale","scale","isNaN","style","willChange","transform","newTool","button","change","applyHooks","toolHooks","pending","pendingMessages","shift","toolName","newtool","event","compiledListeners","listener","onquit","passive","onstart","send","tool","messageHooks","message","handleMessage","messageForTool","_children","batchCall","fn","args","batch","rest","requestAnimationFrame","getScale","compiled","compile","xOffset","offsetLeft","yOffset","offsetTop","pageX","pageY","compileTouch","changedTouches","releaseTouch","hooks","object","hook","prefix","suffix","Date","toString","round","random","createElementNS","namespaceURI","positionElement","top","chooser","clrs","update","onchange","setCanvasScale","scaleToSet","canvasContainer","containerWidth","clientWidth","containerHeight","clientHeight","MAX_HEIGHT","webRTC","boardReady","servers","log","iceServers","localVideo","remoteVideo","initiator","localMediaStream","localConn","gotRemoteDesc","gotLocalDescription","ICE_config","url","credential","username","tryVideoChat","getUserMedia","audio","video","localStream","srcObject","initVideoChat","err","gotRemoteStream","streams","handleLocalIceCandidate","candidate","RTCPeerConnection","addStream","onicecandidate","createOffer","desc","setLocalDescription","JSON","stringify","addIceCandidate","RTCIceCandidate","then","catch","remoteDesc","remoteTempDesc","setRemoteDescription","RTCSessionDescription","createAnswer","localDesc","close","tools","toolUrl","defaultValue","htmlFor","data-translation","step","controls","controlItems","link","click","openModal","control","imgUrl","autoPlay","muted","modal","modalComponent","onChange","inputChanged","valid","sendInvite","closeModal","show","backdrop","backdropComponent","version","xmlns","Room","loaded","pin","guest","_this2","boardScript","alert","_this3","room","email","res","previous","src_components_board_board","components_backdrop_backdrop","toggleModal","components_modal_modal","guestInputChanged","inputValue","validEmail","components_tools_tools","components_controls_controls","teacher","student","App","Route","path","exact","component","Boolean","hostname","match","app","BrowserRouter","src_App_0","ReactDOM","render","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.d241f7ae.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo.12281ab1.svg\";","var map = {\n\t\"./circle.svg\": 97,\n\t\"./drag.svg\": 98,\n\t\"./ellipse.svg\": 99,\n\t\"./erase.svg\": 100,\n\t\"./line.svg\": 101,\n\t\"./pencil.svg\": 102,\n\t\"./rect.svg\": 103,\n\t\"./text.svg\": 104,\n\t\"./zoom.svg\": 105\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 96;","module.exports = __webpack_public_path__ + \"static/media/circle.ff298578.svg\";","module.exports = __webpack_public_path__ + \"static/media/drag.5bd82614.svg\";","module.exports = __webpack_public_path__ + \"static/media/ellipse.1281b0d9.svg\";","module.exports = __webpack_public_path__ + \"static/media/erase.64789475.svg\";","module.exports = __webpack_public_path__ + \"static/media/line.8d9ebd8d.svg\";","module.exports = __webpack_public_path__ + \"static/media/pencil.60a47125.svg\";","module.exports = __webpack_public_path__ + \"static/media/rect.db5e95b3.svg\";","module.exports = __webpack_public_path__ + \"static/media/text.76455579.svg\";","module.exports = __webpack_public_path__ + \"static/media/zoom.47520828.svg\";","var map = {\n\t\"./camera.svg\": 109,\n\t\"./download.svg\": 110,\n\t\"./file.svg\": 111,\n\t\"./info.svg\": 112,\n\t\"./invite.svg\": 113,\n\t\"./microphone.svg\": 114\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 108;","module.exports = __webpack_public_path__ + \"static/media/camera.cd236fa7.svg\";","module.exports = __webpack_public_path__ + \"static/media/download.bc784a68.svg\";","module.exports = __webpack_public_path__ + \"static/media/file.b96b7948.svg\";","module.exports = __webpack_public_path__ + \"static/media/info.e45f19a0.svg\";","module.exports = __webpack_public_path__ + \"static/media/invite.194db11e.svg\";","module.exports = __webpack_public_path__ + \"static/media/microphone.c347fe87.svg\";","const login = (props) => {\r\n\r\n    const socket = props.socket;\r\n\r\n    // socket.on('impossible', err => {\r\n    //     alert(err);\r\n    //     console.log(err);\r\n    // });\r\n    // socket.on('okToJoin', room => {\r\n    //     console.log('joining', room);\r\n    //     props.join(room.roomName);\r\n    //     //this.props.join(room.name);\r\n    // });\r\n    socket.on('setBoardList', data => {\r\n        const newList = data.myBoards;\r\n        props.addBoard(newList);\r\n        //this.setState({roomList: newList});\r\n    });\r\n\r\n\r\n\r\n}\r\n\r\nexport default login;","const endpoints = {\r\n    prod: \"\",\r\n    dev: \"http://localhost:8880/\"\r\n};\r\n\r\nexport default endpoints;","import React from 'react';\r\nimport './header.css';\r\n\r\nconst header = (props) => {\r\n    const logoUrl = require('../../assets/icons/logo.svg');\r\n\r\n    return (\r\n        <div className='header' >\r\n        <a className='link' id='dashboardLink' href={props.dashboardUrl}>&#60; Revenir au tableau de bord</a>\r\n        <div className='headerContainer'>\r\n                <img src={logoUrl} id='logo' alt='logo' />\r\n                <h1 className='brand'>COURS MASSON</h1>\r\n            <h2 className='title'>\r\n                Tableau blanc interactif pour cours particuliers\r\n            </h2>\r\n            <p className='paragraph'>\r\n                Les tableaux blancs interactifs intègrent une fonctionalité de visio-conférence. \r\n                Ils sont conçus pour fournir une expérience pédagogique optimal pour donner un cours particulier en ligne.  \r\n            </p>\r\n\r\n            <button className='btn ctaBtn' onClick={props.create} >Créer un tableau blanc</button>\r\n            <p className='subtitle'>Les tableaux blancs ont une durée de vie 24 heures</p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default header;","import React from 'react';\r\nimport {Link} from 'react-router-dom';\r\n\r\nimport './table.css';\r\n\r\nconst table = (props) => {\r\n    let list = props.boardList;\r\n    // Setup criterias for sorting the boards in chronological order\r\n    function compare (a, b){\r\n        if (a.date > b.date){\r\n            return -1;\r\n        } else if (a.date < b.date){\r\n            return 1;\r\n        } else if(a.date === b.date){\r\n            if (a.time >= b.time){\r\n                return -1;\r\n            } else {\r\n                return 1;\r\n            }\r\n        }\r\n    }\r\n    // Sort boards according to criterias above\r\n    list.sort(compare);\r\n\r\n    let tableItems;\r\n        if (list !== [] && list.length >= 1){\r\n            \r\n            tableItems = list.map((board, index) => {\r\n                const itemText = `Tableau blanc créé le ${board.date} à ${board.time}`;\r\n                return (\r\n                    <div className=\"tableItem\" key={index} >\r\n                        <p className='roomName'>{itemText}\r\n                            <Link to={`/boards/?${board.string}`} >\r\n                                <span className='link joinLink'>Rejoindre</span>\r\n                            </Link>\r\n                        </p>\r\n                    </div>\r\n                );\r\n            });\r\n        } else {\r\n            tableItems = (<div className=\"room\">Il n'y a pas encore de rooms, cliquez sur le bouton ci-dessus pour en créer une.</div> );\r\n        }\r\n    return (\r\n        <div className='table'>\r\n            {tableItems}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default table;","import React, {Component} from 'react';\r\nimport queryString from 'query-string';\r\nimport './Start.css';\r\nimport login from '../../assets/scripts/login';\r\nimport endpoints from '../../assets/config/endpoints.js';\r\nimport Header from '../../components/header/header';\r\nimport Table from '../../components/table/table';\r\n\r\n\r\n\r\nclass Start extends Component {\r\n    state = {\r\n        socket: null,\r\n        userData: {        \r\n            firstName: 'Grégoire',\r\n            lastName: 'LeBeauGosse',\r\n            uid: 'gregocl',\r\n            password: '333888'\r\n        },\r\n        boardList: []\r\n    }\r\n\r\n    componentDidMount(){\r\n        const params = queryString.parse(window.location.search);\r\n        const userData = {\r\n            firstName: params.firstName, \r\n            lastName: params.lastName,\r\n            uid: params.id,\r\n            password: params.password\r\n        }\r\n        const io = require('socket.io-client');\r\n        const socket = io(`${endpoints.prod}`);\r\n        login(\r\n            {\r\n                addBoard: this.addBoardToList.bind(this), \r\n                socket: socket\r\n            }\r\n        );\r\n        socket.emit('getMyBoards', this.state.userData)\r\n        this.setState({socket: socket});\r\n    }\r\n\r\n\r\n    createBoard(){\r\n        if (this.state.socket){\r\n            const socket = this.state.socket;\r\n            socket.emit('createBoard', this.state.userData);\r\n        }\r\n    }\r\n\r\n    addBoardToList(newList){\r\n        this.setState({boardList: newList});\r\n    }\r\n\r\n\r\n    render(){\r\n        \r\n        return(\r\n            <div className='startContainer'>\r\n                <Header create={this.createBoard.bind(this)} dashboardUrl='' />\r\n                <Table boardList={this.state.boardList} />\r\n            </div>\r\n        );\r\n    };\r\n};\r\n\r\nexport default Start;","// @info\r\n//   Polyfill for SVG getPathData() and setPathData() methods. Based on:\r\n//   - SVGPathSeg polyfill by Philip Rogers (MIT License)\r\n//     https://github.com/progers/pathseg\r\n//   - SVGPathNormalizer by Tadahisa Motooka (MIT License)\r\n//     https://github.com/motooka/SVGPathNormalizer/tree/master/src\r\n//   - arcToCubicCurves() by Dmitry Baranovskiy (MIT License)\r\n//     https://github.com/DmitryBaranovskiy/raphael/blob/v2.1.1/raphael.core.js#L1837\r\n// @author\r\n//   Jarosław Foksa\r\n// @license\r\n//   MIT License\r\n\r\nconst pathPolyfill = () => {\r\n  if (!SVGPathElement.prototype.getPathData || !SVGPathElement.prototype.setPathData) {\r\n    (function () {\r\n      var commandsMap = {\r\n        \"Z\": \"Z\",\r\n        \"M\": \"M\",\r\n        \"L\": \"L\",\r\n        \"C\": \"C\",\r\n        \"Q\": \"Q\",\r\n        \"A\": \"A\",\r\n        \"H\": \"H\",\r\n        \"V\": \"V\",\r\n        \"S\": \"S\",\r\n        \"T\": \"T\",\r\n        \"z\": \"Z\",\r\n        \"m\": \"m\",\r\n        \"l\": \"l\",\r\n        \"c\": \"c\",\r\n        \"q\": \"q\",\r\n        \"a\": \"a\",\r\n        \"h\": \"h\",\r\n        \"v\": \"v\",\r\n        \"s\": \"s\",\r\n        \"t\": \"t\"\r\n      };\r\n\r\n      var Source = function (string) {\r\n        this._string = string;\r\n        this._currentIndex = 0;\r\n        this._endIndex = this._string.length;\r\n        this._prevCommand = null;\r\n        this._skipOptionalSpaces();\r\n      };\r\n\r\n      var isIE = window.navigator.userAgent.indexOf(\"MSIE \") !== -1;\r\n\r\n      Source.prototype = {\r\n        parseSegment: function () {\r\n          var char = this._string[this._currentIndex];\r\n          var command = commandsMap[char] ? commandsMap[char] : null;\r\n\r\n          if (command === null) {\r\n            // Possibly an implicit command. Not allowed if this is the first command.\r\n            if (this._prevCommand === null) {\r\n              return null;\r\n            }\r\n\r\n            // Check for remaining coordinates in the current command.\r\n            if (\r\n              (char === \"+\" || char === \"-\" || char === \".\" || (char >= \"0\" && char <= \"9\")) && this._prevCommand !== \"Z\"\r\n            ) {\r\n              if (this._prevCommand === \"M\") {\r\n                command = \"L\";\r\n              } else if (this._prevCommand === \"m\") {\r\n                command = \"l\";\r\n              } else {\r\n                command = this._prevCommand;\r\n              }\r\n            } else {\r\n              command = null;\r\n            }\r\n\r\n            if (command === null) {\r\n              return null;\r\n            }\r\n          } else {\r\n            this._currentIndex += 1;\r\n          }\r\n\r\n          this._prevCommand = command;\r\n\r\n          var values = null;\r\n          var cmd = command.toUpperCase();\r\n\r\n          if (cmd === \"H\" || cmd === \"V\") {\r\n            values = [this._parseNumber()];\r\n          } else if (cmd === \"M\" || cmd === \"L\" || cmd === \"T\") {\r\n            values = [this._parseNumber(), this._parseNumber()];\r\n          } else if (cmd === \"S\" || cmd === \"Q\") {\r\n            values = [this._parseNumber(), this._parseNumber(), this._parseNumber(), this._parseNumber()];\r\n          } else if (cmd === \"C\") {\r\n            values = [\r\n              this._parseNumber(),\r\n              this._parseNumber(),\r\n              this._parseNumber(),\r\n              this._parseNumber(),\r\n              this._parseNumber(),\r\n              this._parseNumber()\r\n            ];\r\n          } else if (cmd === \"A\") {\r\n            values = [\r\n              this._parseNumber(),\r\n              this._parseNumber(),\r\n              this._parseNumber(),\r\n              this._parseArcFlag(),\r\n              this._parseArcFlag(),\r\n              this._parseNumber(),\r\n              this._parseNumber()\r\n            ];\r\n          } else if (cmd === \"Z\") {\r\n            this._skipOptionalSpaces();\r\n            values = [];\r\n          }\r\n\r\n          if (values === null || values.indexOf(null) >= 0) {\r\n            // Unknown command or known command with invalid values\r\n            return null;\r\n          } else {\r\n            return {\r\n              type: command,\r\n              values: values\r\n            };\r\n          }\r\n        },\r\n\r\n        hasMoreData: function () {\r\n          return this._currentIndex < this._endIndex;\r\n        },\r\n\r\n        peekSegmentType: function () {\r\n          var char = this._string[this._currentIndex];\r\n          return commandsMap[char] ? commandsMap[char] : null;\r\n        },\r\n\r\n        initialCommandIsMoveTo: function () {\r\n          // If the path is empty it is still valid, so return true.\r\n          if (!this.hasMoreData()) {\r\n            return true;\r\n          }\r\n\r\n          var command = this.peekSegmentType();\r\n          // Path must start with moveTo.\r\n          return command === \"M\" || command === \"m\";\r\n        },\r\n\r\n        _isCurrentSpace: function () {\r\n          var char = this._string[this._currentIndex];\r\n          return char <= \" \" && (char === \" \" || char === \"\\n\" || char === \"\\t\" || char === \"\\r\" || char === \"\\f\");\r\n        },\r\n\r\n        _skipOptionalSpaces: function () {\r\n          while (this._currentIndex < this._endIndex && this._isCurrentSpace()) {\r\n            this._currentIndex += 1;\r\n          }\r\n\r\n          return this._currentIndex < this._endIndex;\r\n        },\r\n\r\n        _skipOptionalSpacesOrDelimiter: function () {\r\n          if (\r\n            this._currentIndex < this._endIndex &&\r\n            !this._isCurrentSpace() &&\r\n            this._string[this._currentIndex] !== \",\"\r\n          ) {\r\n            return false;\r\n          }\r\n\r\n          if (this._skipOptionalSpaces()) {\r\n            if (this._currentIndex < this._endIndex && this._string[this._currentIndex] === \",\") {\r\n              this._currentIndex += 1;\r\n              this._skipOptionalSpaces();\r\n            }\r\n          }\r\n          return this._currentIndex < this._endIndex;\r\n        },\r\n\r\n        // Parse a number from an SVG path. This very closely follows genericParseNumber(...) from\r\n        // Source/core/svg/SVGParserUtilities.cpp.\r\n        // Spec: http://www.w3.org/TR/SVG11/single-page.html#paths-PathDataBNF\r\n        _parseNumber: function () {\r\n          var exponent = 0;\r\n          var integer = 0;\r\n          var frac = 1;\r\n          var decimal = 0;\r\n          var sign = 1;\r\n          var expsign = 1;\r\n          var startIndex = this._currentIndex;\r\n\r\n          this._skipOptionalSpaces();\r\n\r\n          // Read the sign.\r\n          if (this._currentIndex < this._endIndex && this._string[this._currentIndex] === \"+\") {\r\n            this._currentIndex += 1;\r\n          } else if (this._currentIndex < this._endIndex && this._string[this._currentIndex] === \"-\") {\r\n            this._currentIndex += 1;\r\n            sign = -1;\r\n          }\r\n\r\n          if (\r\n            this._currentIndex === this._endIndex ||\r\n            (\r\n              (this._string[this._currentIndex] < \"0\" || this._string[this._currentIndex] > \"9\") &&\r\n              this._string[this._currentIndex] !== \".\"\r\n            )\r\n          ) {\r\n            // The first character of a number must be one of [0-9+-.].\r\n            return null;\r\n          }\r\n\r\n          // Read the integer part, build right-to-left.\r\n          var startIntPartIndex = this._currentIndex;\r\n\r\n          while (\r\n            this._currentIndex < this._endIndex &&\r\n            this._string[this._currentIndex] >= \"0\" &&\r\n            this._string[this._currentIndex] <= \"9\"\r\n          ) {\r\n            this._currentIndex += 1; // Advance to first non-digit.\r\n          }\r\n\r\n          if (this._currentIndex !== startIntPartIndex) {\r\n            var scanIntPartIndex = this._currentIndex - 1;\r\n            var multiplier = 1;\r\n\r\n            while (scanIntPartIndex >= startIntPartIndex) {\r\n              integer += multiplier * (this._string[scanIntPartIndex] - \"0\");\r\n              scanIntPartIndex -= 1;\r\n              multiplier *= 10;\r\n            }\r\n          }\r\n\r\n          // Read the decimals.\r\n          if (this._currentIndex < this._endIndex && this._string[this._currentIndex] === \".\") {\r\n            this._currentIndex += 1;\r\n\r\n            // There must be a least one digit following the .\r\n            if (\r\n              this._currentIndex >= this._endIndex ||\r\n              this._string[this._currentIndex] < \"0\" ||\r\n              this._string[this._currentIndex] > \"9\"\r\n            ) {\r\n              return null;\r\n            }\r\n\r\n            while (\r\n              this._currentIndex < this._endIndex &&\r\n              this._string[this._currentIndex] >= \"0\" &&\r\n              this._string[this._currentIndex] <= \"9\"\r\n            ) {\r\n              frac *= 10;\r\n              decimal += (this._string.charAt(this._currentIndex) - \"0\") / frac;\r\n              this._currentIndex += 1;\r\n            }\r\n          }\r\n\r\n          // Read the exponent part.\r\n          if (\r\n            this._currentIndex !== startIndex &&\r\n            this._currentIndex + 1 < this._endIndex &&\r\n            (this._string[this._currentIndex] === \"e\" || this._string[this._currentIndex] === \"E\") &&\r\n            (this._string[this._currentIndex + 1] !== \"x\" && this._string[this._currentIndex + 1] !== \"m\")\r\n          ) {\r\n            this._currentIndex += 1;\r\n\r\n            // Read the sign of the exponent.\r\n            if (this._string[this._currentIndex] === \"+\") {\r\n              this._currentIndex += 1;\r\n            } else if (this._string[this._currentIndex] === \"-\") {\r\n              this._currentIndex += 1;\r\n              expsign = -1;\r\n            }\r\n\r\n            // There must be an exponent.\r\n            if (\r\n              this._currentIndex >= this._endIndex ||\r\n              this._string[this._currentIndex] < \"0\" ||\r\n              this._string[this._currentIndex] > \"9\"\r\n            ) {\r\n              return null;\r\n            }\r\n\r\n            while (\r\n              this._currentIndex < this._endIndex &&\r\n              this._string[this._currentIndex] >= \"0\" &&\r\n              this._string[this._currentIndex] <= \"9\"\r\n            ) {\r\n              exponent *= 10;\r\n              exponent += (this._string[this._currentIndex] - \"0\");\r\n              this._currentIndex += 1;\r\n            }\r\n          }\r\n\r\n          var number = integer + decimal;\r\n          number *= sign;\r\n\r\n          if (exponent) {\r\n            number *= Math.pow(10, expsign * exponent);\r\n          }\r\n\r\n          if (startIndex === this._currentIndex) {\r\n            return null;\r\n          }\r\n\r\n          this._skipOptionalSpacesOrDelimiter();\r\n\r\n          return number;\r\n        },\r\n\r\n        _parseArcFlag: function () {\r\n          if (this._currentIndex >= this._endIndex) {\r\n            return null;\r\n          }\r\n\r\n          var flag = null;\r\n          var flagChar = this._string[this._currentIndex];\r\n\r\n          this._currentIndex += 1;\r\n\r\n          if (flagChar === \"0\") {\r\n            flag = 0;\r\n          } else if (flagChar === \"1\") {\r\n            flag = 1;\r\n          } else {\r\n            return null;\r\n          }\r\n\r\n          this._skipOptionalSpacesOrDelimiter();\r\n          return flag;\r\n        }\r\n      };\r\n\r\n      var parsePathDataString = function (string) {\r\n        if (!string || string.length === 0) return [];\r\n\r\n        var source = new Source(string);\r\n        var pathData = [];\r\n\r\n        if (source.initialCommandIsMoveTo()) {\r\n          while (source.hasMoreData()) {\r\n            var pathSeg = source.parseSegment();\r\n\r\n            if (pathSeg === null) {\r\n              break;\r\n            } else {\r\n              pathData.push(pathSeg);\r\n            }\r\n          }\r\n        }\r\n\r\n        return pathData;\r\n      }\r\n\r\n      var setAttribute = SVGPathElement.prototype.setAttribute;\r\n      var removeAttribute = SVGPathElement.prototype.removeAttribute;\r\n\r\n      var $cachedPathData = window.Symbol ? Symbol() : \"__cachedPathData\";\r\n      var $cachedNormalizedPathData = window.Symbol ? Symbol() : \"__cachedNormalizedPathData\";\r\n\r\n      // @info\r\n      //   Get an array of corresponding cubic bezier curve parameters for given arc curve paramters.\r\n      var arcToCubicCurves = function (x1, y1, x2, y2, r1, r2, angle, largeArcFlag, sweepFlag, _recursive) {\r\n        var degToRad = function (degrees) {\r\n          return (Math.PI * degrees) / 180;\r\n        };\r\n\r\n        var rotate = function (x, y, angleRad) {\r\n          var X = x * Math.cos(angleRad) - y * Math.sin(angleRad);\r\n          var Y = x * Math.sin(angleRad) + y * Math.cos(angleRad);\r\n          return {\r\n            x: X,\r\n            y: Y\r\n          };\r\n        };\r\n\r\n        var angleRad = degToRad(angle);\r\n        var params = [];\r\n        var f1, f2, cx, cy;\r\n\r\n        if (_recursive) {\r\n          f1 = _recursive[0];\r\n          f2 = _recursive[1];\r\n          cx = _recursive[2];\r\n          cy = _recursive[3];\r\n        } else {\r\n          var p1 = rotate(x1, y1, -angleRad);\r\n          x1 = p1.x;\r\n          y1 = p1.y;\r\n\r\n          var p2 = rotate(x2, y2, -angleRad);\r\n          x2 = p2.x;\r\n          y2 = p2.y;\r\n\r\n          var x = (x1 - x2) / 2;\r\n          var y = (y1 - y2) / 2;\r\n          var h = (x * x) / (r1 * r1) + (y * y) / (r2 * r2);\r\n\r\n          if (h > 1) {\r\n            h = Math.sqrt(h);\r\n            r1 = h * r1;\r\n            r2 = h * r2;\r\n          }\r\n\r\n          var sign;\r\n\r\n          if (largeArcFlag === sweepFlag) {\r\n            sign = -1;\r\n          } else {\r\n            sign = 1;\r\n          }\r\n\r\n          var r1Pow = r1 * r1;\r\n          var r2Pow = r2 * r2;\r\n\r\n          var left = r1Pow * r2Pow - r1Pow * y * y - r2Pow * x * x;\r\n          var right = r1Pow * y * y + r2Pow * x * x;\r\n\r\n          var k = sign * Math.sqrt(Math.abs(left / right));\r\n\r\n          cx = k * r1 * y / r2 + (x1 + x2) / 2;\r\n          cy = k * -r2 * x / r1 + (y1 + y2) / 2;\r\n\r\n          f1 = Math.asin(parseFloat(((y1 - cy) / r2).toFixed(9)));\r\n          f2 = Math.asin(parseFloat(((y2 - cy) / r2).toFixed(9)));\r\n\r\n          if (x1 < cx) {\r\n            f1 = Math.PI - f1;\r\n          }\r\n          if (x2 < cx) {\r\n            f2 = Math.PI - f2;\r\n          }\r\n\r\n          if (f1 < 0) {\r\n            f1 = Math.PI * 2 + f1;\r\n          }\r\n          if (f2 < 0) {\r\n            f2 = Math.PI * 2 + f2;\r\n          }\r\n\r\n          if (sweepFlag && f1 > f2) {\r\n            f1 = f1 - Math.PI * 2;\r\n          }\r\n          if (!sweepFlag && f2 > f1) {\r\n            f2 = f2 - Math.PI * 2;\r\n          }\r\n        }\r\n\r\n        var df = f2 - f1;\r\n\r\n        if (Math.abs(df) > (Math.PI * 120 / 180)) {\r\n          var f2old = f2;\r\n          var x2old = x2;\r\n          var y2old = y2;\r\n\r\n          if (sweepFlag && f2 > f1) {\r\n            f2 = f1 + (Math.PI * 120 / 180) * (1);\r\n          } else {\r\n            f2 = f1 + (Math.PI * 120 / 180) * (-1);\r\n          }\r\n\r\n          x2 = cx + r1 * Math.cos(f2);\r\n          y2 = cy + r2 * Math.sin(f2);\r\n          params = arcToCubicCurves(x2, y2, x2old, y2old, r1, r2, angle, 0, sweepFlag, [f2, f2old, cx, cy]);\r\n        }\r\n\r\n        df = f2 - f1;\r\n\r\n        var c1 = Math.cos(f1);\r\n        var s1 = Math.sin(f1);\r\n        var c2 = Math.cos(f2);\r\n        var s2 = Math.sin(f2);\r\n        var t = Math.tan(df / 4);\r\n        var hx = 4 / 3 * r1 * t;\r\n        var hy = 4 / 3 * r2 * t;\r\n\r\n        var m1 = [x1, y1];\r\n        var m2 = [x1 + hx * s1, y1 - hy * c1];\r\n        var m3 = [x2 + hx * s2, y2 - hy * c2];\r\n        var m4 = [x2, y2];\r\n\r\n        m2[0] = 2 * m1[0] - m2[0];\r\n        m2[1] = 2 * m1[1] - m2[1];\r\n\r\n        if (_recursive) {\r\n          return [m2, m3, m4].concat(params);\r\n        } else {\r\n          params = [m2, m3, m4].concat(params);\r\n\r\n          var curves = [];\r\n\r\n          for (var i = 0; i < params.length; i += 3) {\r\n            r1 = rotate(params[i][0], params[i][1], angleRad);\r\n            r2 = rotate(params[i + 1][0], params[i + 1][1], angleRad);\r\n            var r3 = rotate(params[i + 2][0], params[i + 2][1], angleRad);\r\n            curves.push([r1.x, r1.y, r2.x, r2.y, r3.x, r3.y]);\r\n          }\r\n\r\n          return curves;\r\n        }\r\n      };\r\n\r\n      var clonePathData = function (pathData) {\r\n        return pathData.map(function (seg) {\r\n          return {\r\n            type: seg.type,\r\n            values: Array.prototype.slice.call(seg.values)\r\n          }\r\n        });\r\n      };\r\n\r\n      // @info\r\n      //   Takes any path data, returns path data that consists only from absolute commands.\r\n      var absolutizePathData = function (pathData) {\r\n        var absolutizedPathData = [];\r\n\r\n        var currentX = null;\r\n        var currentY = null;\r\n\r\n        var subpathX = null;\r\n        var subpathY = null;\r\n\r\n        pathData.forEach(function (seg) {\r\n          var type = seg.type;\r\n\r\n          if (type === \"M\") {\r\n            var x = seg.values[0];\r\n            var y = seg.values[1];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"M\",\r\n              values: [x, y]\r\n            });\r\n\r\n            subpathX = x;\r\n            subpathY = y;\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"m\") {\r\n            x = currentX + seg.values[0];\r\n            y = currentY + seg.values[1];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"M\",\r\n              values: [x, y]\r\n            });\r\n\r\n            subpathX = x;\r\n            subpathY = y;\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"L\") {\r\n            x = seg.values[0];\r\n            y = seg.values[1];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"L\",\r\n              values: [x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"l\") {\r\n            x = currentX + seg.values[0];\r\n            y = currentY + seg.values[1];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"L\",\r\n              values: [x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"C\") {\r\n            var x1 = seg.values[0];\r\n            var y1 = seg.values[1];\r\n            var x2 = seg.values[2];\r\n            var y2 = seg.values[3];\r\n            x = seg.values[4];\r\n            y = seg.values[5];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"C\",\r\n              values: [x1, y1, x2, y2, x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"c\") {\r\n            x1 = currentX + seg.values[0];\r\n            y1 = currentY + seg.values[1];\r\n            x2 = currentX + seg.values[2];\r\n            y2 = currentY + seg.values[3];\r\n            x = currentX + seg.values[4];\r\n            y = currentY + seg.values[5];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"C\",\r\n              values: [x1, y1, x2, y2, x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"Q\") {\r\n            x1 = seg.values[0];\r\n            y1 = seg.values[1];\r\n            x = seg.values[2];\r\n            y = seg.values[3];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"Q\",\r\n              values: [x1, y1, x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"q\") {\r\n            x1 = currentX + seg.values[0];\r\n            y1 = currentY + seg.values[1];\r\n            x = currentX + seg.values[2];\r\n            y = currentY + seg.values[3];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"Q\",\r\n              values: [x1, y1, x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"A\") {\r\n            x = seg.values[5];\r\n            y = seg.values[6];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"A\",\r\n              values: [seg.values[0], seg.values[1], seg.values[2], seg.values[3], seg.values[4], x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"a\") {\r\n            x = currentX + seg.values[5];\r\n            y = currentY + seg.values[6];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"A\",\r\n              values: [seg.values[0], seg.values[1], seg.values[2], seg.values[3], seg.values[4], x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"H\") {\r\n            x = seg.values[0];\r\n            absolutizedPathData.push({\r\n              type: \"H\",\r\n              values: [x]\r\n            });\r\n            currentX = x;\r\n          } else if (type === \"h\") {\r\n            x = currentX + seg.values[0];\r\n            absolutizedPathData.push({\r\n              type: \"H\",\r\n              values: [x]\r\n            });\r\n            currentX = x;\r\n          } else if (type === \"V\") {\r\n            y = seg.values[0];\r\n            absolutizedPathData.push({\r\n              type: \"V\",\r\n              values: [y]\r\n            });\r\n            currentY = y;\r\n          } else if (type === \"v\") {\r\n            y = currentY + seg.values[0];\r\n            absolutizedPathData.push({\r\n              type: \"V\",\r\n              values: [y]\r\n            });\r\n            currentY = y;\r\n          } else if (type === \"S\") {\r\n            x2 = seg.values[0];\r\n            y2 = seg.values[1];\r\n            x = seg.values[2];\r\n            y = seg.values[3];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"S\",\r\n              values: [x2, y2, x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"s\") {\r\n            x2 = currentX + seg.values[0];\r\n            y2 = currentY + seg.values[1];\r\n            x = currentX + seg.values[2];\r\n            y = currentY + seg.values[3];\r\n\r\n            absolutizedPathData.push({\r\n              type: \"S\",\r\n              values: [x2, y2, x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"T\") {\r\n            x = seg.values[0];\r\n            y = seg.values[1]\r\n\r\n            absolutizedPathData.push({\r\n              type: \"T\",\r\n              values: [x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"t\") {\r\n            x = currentX + seg.values[0];\r\n            y = currentY + seg.values[1]\r\n\r\n            absolutizedPathData.push({\r\n              type: \"T\",\r\n              values: [x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (type === \"Z\" || type === \"z\") {\r\n            absolutizedPathData.push({\r\n              type: \"Z\",\r\n              values: []\r\n            });\r\n\r\n            currentX = subpathX;\r\n            currentY = subpathY;\r\n          }\r\n        });\r\n\r\n        return absolutizedPathData;\r\n      };\r\n\r\n      // @info\r\n      //   Takes path data that consists only from absolute commands, returns path data that consists only from\r\n      //   \"M\", \"L\", \"C\" and \"Z\" commands.\r\n      var reducePathData = function (pathData) {\r\n        var reducedPathData = [];\r\n        var lastType = null;\r\n\r\n        var lastControlX = null;\r\n        var lastControlY = null;\r\n\r\n        var currentX = null;\r\n        var currentY = null;\r\n\r\n        var subpathX = null;\r\n        var subpathY = null;\r\n\r\n        pathData.forEach(function (seg) {\r\n          if (seg.type === \"M\") {\r\n            var x = seg.values[0];\r\n            var y = seg.values[1];\r\n\r\n            reducedPathData.push({\r\n              type: \"M\",\r\n              values: [x, y]\r\n            });\r\n\r\n            subpathX = x;\r\n            subpathY = y;\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (seg.type === \"C\") {\r\n            var x1 = seg.values[0];\r\n            var y1 = seg.values[1];\r\n            var x2 = seg.values[2];\r\n            var y2 = seg.values[3];\r\n            x = seg.values[4];\r\n            y = seg.values[5];\r\n\r\n            reducedPathData.push({\r\n              type: \"C\",\r\n              values: [x1, y1, x2, y2, x, y]\r\n            });\r\n\r\n            lastControlX = x2;\r\n            lastControlY = y2;\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (seg.type === \"L\") {\r\n            x = seg.values[0];\r\n            y = seg.values[1];\r\n\r\n            reducedPathData.push({\r\n              type: \"L\",\r\n              values: [x, y]\r\n            });\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (seg.type === \"H\") {\r\n            x = seg.values[0];\r\n\r\n            reducedPathData.push({\r\n              type: \"L\",\r\n              values: [x, currentY]\r\n            });\r\n\r\n            currentX = x;\r\n          } else if (seg.type === \"V\") {\r\n            y = seg.values[0];\r\n\r\n            reducedPathData.push({\r\n              type: \"L\",\r\n              values: [currentX, y]\r\n            });\r\n\r\n            currentY = y;\r\n          } else if (seg.type === \"S\") {\r\n            x2 = seg.values[0];\r\n            y2 = seg.values[1];\r\n            x = seg.values[2];\r\n            y = seg.values[3];\r\n\r\n            var cx1, cy1;\r\n\r\n            if (lastType === \"C\" || lastType === \"S\") {\r\n              cx1 = currentX + (currentX - lastControlX);\r\n              cy1 = currentY + (currentY - lastControlY);\r\n            } else {\r\n              cx1 = currentX;\r\n              cy1 = currentY;\r\n            }\r\n\r\n            reducedPathData.push({\r\n              type: \"C\",\r\n              values: [cx1, cy1, x2, y2, x, y]\r\n            });\r\n\r\n            lastControlX = x2;\r\n            lastControlY = y2;\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (seg.type === \"T\") {\r\n            x = seg.values[0];\r\n            y = seg.values[1];\r\n\r\n            \r\n\r\n            if (lastType === \"Q\" || lastType === \"T\") {\r\n              x1 = currentX + (currentX - lastControlX);\r\n              y1 = currentY + (currentY - lastControlY);\r\n            } else {\r\n              x1 = currentX;\r\n              y1 = currentY;\r\n            }\r\n\r\n            cx1 = currentX + 2 * (x1 - currentX) / 3;\r\n            cy1 = currentY + 2 * (y1 - currentY) / 3;\r\n            var cx2 = x + 2 * (x1 - x) / 3;\r\n            var cy2 = y + 2 * (y1 - y) / 3;\r\n\r\n            reducedPathData.push({\r\n              type: \"C\",\r\n              values: [cx1, cy1, cx2, cy2, x, y]\r\n            });\r\n\r\n            lastControlX = x1;\r\n            lastControlY = y1;\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (seg.type === \"Q\") {\r\n            x1 = seg.values[0];\r\n            y1 = seg.values[1];\r\n            x = seg.values[2];\r\n            y = seg.values[3];\r\n\r\n            cx1 = currentX + 2 * (x1 - currentX) / 3;\r\n            cy1 = currentY + 2 * (y1 - currentY) / 3;\r\n            cx2 = x + 2 * (x1 - x) / 3;\r\n            cy2 = y + 2 * (y1 - y) / 3;\r\n\r\n            reducedPathData.push({\r\n              type: \"C\",\r\n              values: [cx1, cy1, cx2, cy2, x, y]\r\n            });\r\n\r\n            lastControlX = x1;\r\n            lastControlY = y1;\r\n\r\n            currentX = x;\r\n            currentY = y;\r\n          } else if (seg.type === \"A\") {\r\n            var r1 = Math.abs(seg.values[0]);\r\n            var r2 = Math.abs(seg.values[1]);\r\n            var angle = seg.values[2];\r\n            var largeArcFlag = seg.values[3];\r\n            var sweepFlag = seg.values[4];\r\n            x = seg.values[5];\r\n            y = seg.values[6];\r\n\r\n            if (r1 === 0 || r2 === 0) {\r\n              reducedPathData.push({\r\n                type: \"C\",\r\n                values: [currentX, currentY, x, y, x, y]\r\n              });\r\n\r\n              currentX = x;\r\n              currentY = y;\r\n            } else {\r\n              if (currentX !== x || currentY !== y) {\r\n                var curves = arcToCubicCurves(currentX, currentY, x, y, r1, r2, angle, largeArcFlag, sweepFlag);\r\n\r\n                curves.forEach(function (curve) {\r\n                  reducedPathData.push({\r\n                    type: \"C\",\r\n                    values: curve\r\n                  });\r\n                });\r\n\r\n                currentX = x;\r\n                currentY = y;\r\n              }\r\n            }\r\n          } else if (seg.type === \"Z\") {\r\n            reducedPathData.push(seg);\r\n\r\n            currentX = subpathX;\r\n            currentY = subpathY;\r\n          }\r\n\r\n          lastType = seg.type;\r\n        });\r\n\r\n        return reducedPathData;\r\n      };\r\n\r\n      SVGPathElement.prototype.setAttribute = function (name, value) {\r\n        if (name === \"d\") {\r\n          this[$cachedPathData] = null;\r\n          this[$cachedNormalizedPathData] = null;\r\n        }\r\n\r\n        setAttribute.call(this, name, value);\r\n      };\r\n\r\n      SVGPathElement.prototype.removeAttribute = function (name, value) {\r\n        if (name === \"d\") {\r\n          this[$cachedPathData] = null;\r\n          this[$cachedNormalizedPathData] = null;\r\n        }\r\n\r\n        removeAttribute.call(this, name);\r\n      };\r\n\r\n      SVGPathElement.prototype.getPathData = function (options) {\r\n        if (options && options.normalize) {\r\n          if (this[$cachedNormalizedPathData]) {\r\n            return clonePathData(this[$cachedNormalizedPathData]);\r\n          } else {\r\n            var pathData;\r\n\r\n            if (this[$cachedPathData]) {\r\n              pathData = clonePathData(this[$cachedPathData]);\r\n            } else {\r\n              pathData = parsePathDataString(this.getAttribute(\"d\") || \"\");\r\n              this[$cachedPathData] = clonePathData(pathData);\r\n            }\r\n\r\n            var normalizedPathData = reducePathData(absolutizePathData(pathData));\r\n            this[$cachedNormalizedPathData] = clonePathData(normalizedPathData);\r\n            return normalizedPathData;\r\n          }\r\n        } else {\r\n          if (this[$cachedPathData]) {\r\n            return clonePathData(this[$cachedPathData]);\r\n          } else {\r\n            pathData = parsePathDataString(this.getAttribute(\"d\") || \"\");\r\n            this[$cachedPathData] = clonePathData(pathData);\r\n            return pathData;\r\n          }\r\n        }\r\n      };\r\n\r\n      SVGPathElement.prototype.setPathData = function (pathData) {\r\n        if (pathData.length === 0) {\r\n          if (isIE) {\r\n            // @bugfix https://github.com/mbostock/d3/issues/1737\r\n            this.setAttribute(\"d\", \"\");\r\n          } else {\r\n            this.removeAttribute(\"d\");\r\n          }\r\n        } else {\r\n          var d = \"\";\r\n\r\n          for (var i = 0, l = pathData.length; i < l; i += 1) {\r\n            var seg = pathData[i];\r\n\r\n            if (i > 0) {\r\n              d += \" \";\r\n            }\r\n\r\n            d += seg.type;\r\n\r\n            if (seg.values && seg.values.length > 0) {\r\n              d += \" \" + seg.values.join(\" \");\r\n            }\r\n          }\r\n\r\n          this.setAttribute(\"d\", d);\r\n        }\r\n      };\r\n\r\n      SVGRectElement.prototype.getPathData = function (options) {\r\n        var x = this.x.baseVal.value;\r\n        var y = this.y.baseVal.value;\r\n        var width = this.width.baseVal.value;\r\n        var height = this.height.baseVal.value;\r\n        var rx = this.hasAttribute(\"rx\") ? this.rx.baseVal.value : this.ry.baseVal.value;\r\n        var ry = this.hasAttribute(\"ry\") ? this.ry.baseVal.value : this.rx.baseVal.value;\r\n\r\n        if (rx > width / 2) {\r\n          rx = width / 2;\r\n        }\r\n\r\n        if (ry > height / 2) {\r\n          ry = height / 2;\r\n        }\r\n\r\n        var pathData = [{\r\n            type: \"M\",\r\n            values: [x + rx, y]\r\n          },\r\n          {\r\n            type: \"H\",\r\n            values: [x + width - rx]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [rx, ry, 0, 0, 1, x + width, y + ry]\r\n          },\r\n          {\r\n            type: \"V\",\r\n            values: [y + height - ry]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [rx, ry, 0, 0, 1, x + width - rx, y + height]\r\n          },\r\n          {\r\n            type: \"H\",\r\n            values: [x + rx]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [rx, ry, 0, 0, 1, x, y + height - ry]\r\n          },\r\n          {\r\n            type: \"V\",\r\n            values: [y + ry]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [rx, ry, 0, 0, 1, x + rx, y]\r\n          },\r\n          {\r\n            type: \"Z\",\r\n            values: []\r\n          }\r\n        ];\r\n\r\n        // Get rid of redundant \"A\" segs when either rx or ry is 0\r\n        pathData = pathData.filter(function (s) {\r\n          return s.type === \"A\" && (s.values[0] === 0 || s.values[1] === 0) ? false : true;\r\n        });\r\n\r\n        if (options && options.normalize === true) {\r\n          pathData = reducePathData(pathData);\r\n        }\r\n\r\n        return pathData;\r\n      };\r\n\r\n      SVGCircleElement.prototype.getPathData = function (options) {\r\n        var cx = this.cx.baseVal.value;\r\n        var cy = this.cy.baseVal.value;\r\n        var r = this.r.baseVal.value;\r\n\r\n        var pathData = [{\r\n            type: \"M\",\r\n            values: [cx + r, cy]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [r, r, 0, 0, 1, cx, cy + r]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [r, r, 0, 0, 1, cx - r, cy]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [r, r, 0, 0, 1, cx, cy - r]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [r, r, 0, 0, 1, cx + r, cy]\r\n          },\r\n          {\r\n            type: \"Z\",\r\n            values: []\r\n          }\r\n        ];\r\n\r\n        if (options && options.normalize === true) {\r\n          pathData = reducePathData(pathData);\r\n        }\r\n\r\n        return pathData;\r\n      };\r\n\r\n      SVGEllipseElement.prototype.getPathData = function (options) {\r\n        var cx = this.cx.baseVal.value;\r\n        var cy = this.cy.baseVal.value;\r\n        var rx = this.rx.baseVal.value;\r\n        var ry = this.ry.baseVal.value;\r\n\r\n        var pathData = [{\r\n            type: \"M\",\r\n            values: [cx + rx, cy]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [rx, ry, 0, 0, 1, cx, cy + ry]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [rx, ry, 0, 0, 1, cx - rx, cy]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [rx, ry, 0, 0, 1, cx, cy - ry]\r\n          },\r\n          {\r\n            type: \"A\",\r\n            values: [rx, ry, 0, 0, 1, cx + rx, cy]\r\n          },\r\n          {\r\n            type: \"Z\",\r\n            values: []\r\n          }\r\n        ];\r\n\r\n        if (options && options.normalize === true) {\r\n          pathData = reducePathData(pathData);\r\n        }\r\n\r\n        return pathData;\r\n      };\r\n\r\n      SVGLineElement.prototype.getPathData = function () {\r\n        return [{\r\n            type: \"M\",\r\n            values: [this.x1.baseVal.value, this.y1.baseVal.value]\r\n          },\r\n          {\r\n            type: \"L\",\r\n            values: [this.x2.baseVal.value, this.y2.baseVal.value]\r\n          }\r\n        ];\r\n      };\r\n\r\n      SVGPolylineElement.prototype.getPathData = function () {\r\n        var pathData = [];\r\n\r\n        for (var i = 0; i < this.points.numberOfItems; i += 1) {\r\n          var point = this.points.getItem(i);\r\n\r\n          pathData.push({\r\n            type: (i === 0 ? \"M\" : \"L\"),\r\n            values: [point.x, point.y]\r\n          });\r\n        }\r\n\r\n        return pathData;\r\n      };\r\n\r\n      SVGPolygonElement.prototype.getPathData = function () {\r\n        var pathData = [];\r\n\r\n        for (var i = 0; i < this.points.numberOfItems; i += 1) {\r\n          var point = this.points.getItem(i);\r\n\r\n          pathData.push({\r\n            type: (i === 0 ? \"M\" : \"L\"),\r\n            values: [point.x, point.y]\r\n          });\r\n        }\r\n\r\n        pathData.push({\r\n          type: \"Z\",\r\n          values: []\r\n        });\r\n\r\n        return pathData;\r\n      };\r\n    })();\r\n  }\r\n}\r\n\r\nexport default pathPolyfill;","const toolScript = (Tools) => {\r\n\r\n\t//////////////////////////////////////////////////////////////////////////////////////\r\n\t/////////////////    PENCIL    ////////////////////////////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\t(function () { //Code isolation\r\n\r\n\t\t//Indicates the id of the line the user is currently drawing or an empty string while the user is not drawing\r\n\t\tvar curLineId = \"\",\r\n\t\t\tlastTime = performance.now(); //The time at which the last point was drawn\r\n\r\n\t\t//The data of the message that will be sent for every new point\r\n\t\tfunction PointMessage(x, y) {\r\n\t\t\tthis.type = 'child';\r\n\t\t\tthis.parent = curLineId;\r\n\t\t\tthis.x = x;\r\n\t\t\tthis.y = y;\r\n\t\t}\r\n\r\n\t\tfunction startLine(x, y, evt) {\r\n\r\n\t\t\t//Prevent the press from being interpreted by the browser\r\n\t\t\tevt.preventDefault();\r\n\r\n\t\t\tcurLineId = Tools.generateUID(\"l\"); //\"l\" for line\r\n\r\n\t\t\tTools.drawAndSend({\r\n\t\t\t\t'type': 'line',\r\n\t\t\t\t'id': curLineId,\r\n\t\t\t\t'color': Tools.getColor(),\r\n\t\t\t\t'size': Tools.getSize(),\r\n\t\t\t\t'opacity': Tools.getOpacity()\r\n\t\t\t});\r\n\r\n\t\t\t//Immediatly add a point to the line\r\n\t\t\tcontinueLine(x, y);\r\n\t\t}\r\n\r\n\t\tfunction continueLine(x, y, evt) {\r\n\t\t\t/*Wait 70ms before adding any point to the currently drawing line.\r\n\t\t\tThis allows the animation to be smother*/\r\n\t\t\tif (curLineId !== \"\" && performance.now() - lastTime > 70) {\r\n\t\t\t\tTools.drawAndSend(new PointMessage(x, y));\r\n\t\t\t\tlastTime = performance.now();\r\n\t\t\t}\r\n\t\t\tif (evt) evt.preventDefault();\r\n\t\t}\r\n\r\n\t\tfunction stopLine(x, y) {\r\n\t\t\t//Add a last point to the line\r\n\t\t\tcontinueLine(x, y);\r\n\t\t\tcurLineId = \"\";\r\n\t\t}\r\n\r\n\t\tvar renderingLine = {};\r\n\r\n\t\tfunction draw(data) {\r\n\t\t\tswitch (data.type) {\r\n\t\t\t\tcase \"line\":\r\n\t\t\t\t\trenderingLine = createLine(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"child\":\r\n\t\t\t\t\tvar line = (renderingLine.id === data.parent) ? renderingLine : svg.getElementById(data.parent);\r\n\t\t\t\t\tif (!line) {\r\n\t\t\t\t\t\tconsole.error(\"Pencil: Hmmm... I received a point of a line that has not been created (%s).\", data.parent);\r\n\t\t\t\t\t\tline = renderingLine = createLine({\r\n\t\t\t\t\t\t\t\"id\": data.parent\r\n\t\t\t\t\t\t}); //create a new line in order not to loose the points\r\n\t\t\t\t\t}\r\n\t\t\t\t\taddPoint(line, data.x, data.y);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"endline\":\r\n\t\t\t\t\t//TODO?\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.error(\"Pencil: Draw instruction with unknown type. \", data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction dist(x1, y1, x2, y2) {\r\n\t\t\t//Returns the distance between (x1,y1) and (x2,y2)\r\n\t\t\treturn Math.hypot(x2 - x1, y2 - y1);\r\n\t\t}\r\n\r\n\t\tvar pathDataCache = {};\r\n\r\n\t\tfunction getPathData(line) {\r\n\t\t\tvar pathData = pathDataCache[line.id];\r\n\t\t\tif (!pathData) {\r\n\t\t\t\tpathData = line.getPathData();\r\n\t\t\t\tpathDataCache[line.id] = pathData;\r\n\t\t\t}\r\n\t\t\treturn pathData;\r\n\t\t}\r\n\r\n\t\tvar svg = Tools.svg;\r\n\r\n\t\tfunction addPoint(line, x, y) {\r\n\t\t\tvar pts = getPathData(line), //The points that are already in the line as a PathData\r\n\t\t\t\tnbr = pts.length; //The number of points already in the line\r\n\t\t\tswitch (nbr) {\r\n\t\t\t\tcase 0: //The first point in the line\r\n\t\t\t\t\t//If there is no point, we have to start the line with a moveTo statement\r\n\t\t\t\t\tvar npoint = {\r\n\t\t\t\t\t\ttype: \"M\",\r\n\t\t\t\t\t\tvalues: [x, y]\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1: //There is only one point.\r\n\t\t\t\t\t//Draw a curve that is segment between the old point and the new one\r\n\t\t\t\t\tnpoint = {\r\n\t\t\t\t\t\ttype: \"C\",\r\n\t\t\t\t\t\tvalues: [\r\n\t\t\t\t\t\t\tpts[0].values[0], pts[0].values[1],\r\n\t\t\t\t\t\t\tx, y,\r\n\t\t\t\t\t\t\tx, y,\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault: //There are at least two points in the line\r\n\t\t\t\t\t//We add the new point, and smoothen the line\r\n\t\t\t\t\tvar ANGULARITY = 3; //The lower this number, the smoother the line\r\n\t\t\t\t\tvar prev_values = pts[nbr - 1].values; // Previous point\r\n\t\t\t\t\tvar ante_values = pts[nbr - 2].values; // Point before the previous one\r\n\t\t\t\t\tvar prev_x = prev_values[prev_values.length - 2];\r\n\t\t\t\t\tvar prev_y = prev_values[prev_values.length - 1];\r\n\t\t\t\t\tvar ante_x = ante_values[ante_values.length - 2];\r\n\t\t\t\t\tvar ante_y = ante_values[ante_values.length - 1];\r\n\r\n\r\n\t\t\t\t\t//We don't want to add the same point twice consecutively\r\n\t\t\t\t\tif ((prev_x === x && prev_y === y) ||\r\n\t\t\t\t\t\t(ante_x === x && ante_y === y)) return;\r\n\r\n\t\t\t\t\tvar vectx = x - ante_x,\r\n\t\t\t\t\t\tvecty = y - ante_y;\r\n\t\t\t\t\tvar norm = Math.hypot(vectx, vecty);\r\n\t\t\t\t\tvar dist1 = dist(ante_x, ante_y, prev_x, prev_y) / norm,\r\n\t\t\t\t\t\tdist2 = dist(x, y, prev_x, prev_y) / norm;\r\n\t\t\t\t\tvectx /= ANGULARITY;\r\n\t\t\t\t\tvecty /= ANGULARITY;\r\n\t\t\t\t\t//Create 2 control points around the last point\r\n\t\t\t\t\tvar cx1 = prev_x - dist1 * vectx,\r\n\t\t\t\t\t\tcy1 = prev_y - dist1 * vecty, //First control point\r\n\t\t\t\t\t\tcx2 = prev_x + dist2 * vectx,\r\n\t\t\t\t\t\tcy2 = prev_y + dist2 * vecty; //Second control point\r\n\t\t\t\t\tprev_values[2] = cx1;\r\n\t\t\t\t\tprev_values[3] = cy1;\r\n\r\n\t\t\t\t\tnpoint = {\r\n\t\t\t\t\t\ttype: \"C\",\r\n\t\t\t\t\t\tvalues: [\r\n\t\t\t\t\t\t\tcx2, cy2,\r\n\t\t\t\t\t\t\tx, y,\r\n\t\t\t\t\t\t\tx, y,\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tpts.push(npoint);\r\n\t\t\tline.setPathData(pts);\r\n\t\t}\r\n\r\n\t\tfunction createLine(lineData) {\r\n\t\t\t//Creates a new line on the canvas, or update a line that already exists with new information\r\n\t\t\tvar line = svg.getElementById(lineData.id) || Tools.createSVGElement(\"path\");\r\n\t\t\tline.id = lineData.id;\r\n\t\t\t//If some data is not provided, choose default value. The line may be updated later\r\n\t\t\tline.setAttribute(\"stroke\", lineData.color || \"black\");\r\n\t\t\tline.setAttribute(\"stroke-width\", lineData.size || 10);\r\n\t\t\tline.setAttribute(\"opacity\", Math.max(0.1, Math.min(1, lineData.opacity)) || 1);\r\n\t\t\tsvg.appendChild(line);\r\n\t\t\treturn line;\r\n\t\t}\r\n\r\n\t\tTools.add({ //The new tool\r\n\t\t\t\"name\": \"Pencil\",\r\n\t\t\t\"listeners\": {\r\n\t\t\t\t\"press\": startLine,\r\n\t\t\t\t\"move\": continueLine,\r\n\t\t\t\t\"release\": stopLine,\r\n\t\t\t},\r\n\t\t\t\"draw\": draw\r\n\t\t});\r\n\r\n\t})(); //End of code isolation\r\n\r\n\r\n\t//////////////////////////////////////////////////////////////////////////////////////\r\n\t/////////////////    LINE    ////////////////////////////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\t(function () { //Code isolation\r\n\t\t//Indicates the id of the line the user is currently drawing or an empty string while the user is not drawing\r\n\t\tvar curLineId = \"\",\r\n\t\t\tlastTime = performance.now(); //The time at which the last point was drawn\r\n\r\n\t\t//The data of the message that will be sent for every update\r\n\t\tfunction UpdateMessage(x, y) {\r\n\t\t\tthis.type = 'update';\r\n\t\t\tthis.id = curLineId;\r\n\t\t\tthis.x2 = x;\r\n\t\t\tthis.y2 = y;\r\n\t\t}\r\n\r\n\t\tfunction startLine(x, y, evt) {\r\n\r\n\t\t\t//Prevent the press from being interpreted by the browser\r\n\t\t\tevt.preventDefault();\r\n\r\n\t\t\tcurLineId = Tools.generateUID(\"s\"); //\"s\" for straight line\r\n\r\n\t\t\tTools.drawAndSend({\r\n\t\t\t\t'type': 'straight',\r\n\t\t\t\t'id': curLineId,\r\n\t\t\t\t'color': Tools.getColor(),\r\n\t\t\t\t'size': Tools.getSize(),\r\n\t\t\t\t'opacity': Tools.getOpacity(),\r\n\t\t\t\t'x': x,\r\n\t\t\t\t'y': y\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction continueLine(x, y, evt) {\r\n\t\t\t/*Wait 70ms before adding any point to the currently drawing line.\r\n\t\t\tThis allows the animation to be smother*/\r\n\t\t\tif (curLineId !== \"\") {\r\n\t\t\t\tif (performance.now() - lastTime > 70) {\r\n\t\t\t\t\tTools.drawAndSend(new UpdateMessage(x, y));\r\n\t\t\t\t\tlastTime = performance.now();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdraw(new UpdateMessage(x, y));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (evt) evt.preventDefault();\r\n\t\t}\r\n\r\n\t\tfunction stopLine(x, y) {\r\n\t\t\t//Add a last point to the line\r\n\t\t\tcontinueLine(x, y);\r\n\t\t\tcurLineId = \"\";\r\n\t\t}\r\n\r\n\t\tfunction draw(data) {\r\n\t\t\tswitch (data.type) {\r\n\t\t\t\tcase \"straight\":\r\n\t\t\t\t\tcreateLine(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"update\":\r\n\t\t\t\t\tvar line = svg.getElementById(data['id']);\r\n\t\t\t\t\tif (!line) {\r\n\t\t\t\t\t\tconsole.error(\"Straight line: Hmmm... I received a point of a line that has not been created (%s).\", data['id']);\r\n\t\t\t\t\t\tcreateLine({ //create a new line in order not to loose the points\r\n\t\t\t\t\t\t\t\"id\": data['id'],\r\n\t\t\t\t\t\t\t\"x\": data['x2'],\r\n\t\t\t\t\t\t\t\"y\": data['y2']\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdateLine(line, data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.error(\"Straight Line: Draw instruction with unknown type. \", data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar svg = Tools.svg;\r\n\r\n\t\tfunction createLine(lineData) {\r\n\t\t\t//Creates a new line on the canvas, or update a line that already exists with new information\r\n\t\t\tvar line = svg.getElementById(lineData.id) || Tools.createSVGElement(\"line\");\r\n\t\t\tline.id = lineData.id;\r\n\t\t\tline.x1.baseVal.value = lineData['x'];\r\n\t\t\tline.y1.baseVal.value = lineData['y'];\r\n\t\t\tline.x2.baseVal.value = lineData['x2'] || lineData['x'];\r\n\t\t\tline.y2.baseVal.value = lineData['y2'] || lineData['y'];\r\n\t\t\t//If some data is not provided, choose default value. The line may be updated later\r\n\t\t\tline.setAttribute(\"stroke\", lineData.color || \"black\");\r\n\t\t\tline.setAttribute(\"stroke-width\", lineData.size || 10);\r\n\t\t\tline.setAttribute(\"opacity\", Math.max(0.1, Math.min(1, lineData.opacity)) || 1);\r\n\t\t\tsvg.appendChild(line);\r\n\t\t\treturn line;\r\n\t\t}\r\n\r\n\t\tfunction updateLine(line, data) {\r\n\t\t\tline.x2.baseVal.value = data['x2'];\r\n\t\t\tline.y2.baseVal.value = data['y2'];\r\n\t\t}\r\n\r\n\t\tTools.add({ //The new tool\r\n\t\t\t\"name\": \"Straight line\",\r\n\t\t\t\"listeners\": {\r\n\t\t\t\t\"press\": startLine,\r\n\t\t\t\t\"move\": continueLine,\r\n\t\t\t\t\"release\": stopLine,\r\n\t\t\t},\r\n\t\t\t\"draw\": draw\r\n\t\t});\r\n\r\n\t})(); //End of code isolation\r\n\r\n\r\n\r\n\t//////////////////////////////////////////////////////////////////////////////////////\r\n\t/////////////////    RECTANGLE    ////////////////////////////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\t(function () { //Code isolation\r\n\t\t//Indicates the id of the shape the user is currently drawing or an empty string while the user is not drawing\r\n\t\tvar curId = \"\",\r\n\t\t\tcurUpdate = { //The data of the message that will be sent for every new point\r\n\t\t\t\t'type': 'update',\r\n\t\t\t\t'id': \"\",\r\n\t\t\t\t'x': 0,\r\n\t\t\t\t'y': 0,\r\n\t\t\t\t'x2': 0,\r\n\t\t\t\t'y2': 0\r\n\t\t\t},\r\n\t\t\tlastTime = performance.now(); //The time at which the last point was drawn\r\n\r\n\t\tfunction start(x, y, evt) {\r\n\r\n\t\t\t//Prevent the press from being interpreted by the browser\r\n\t\t\tevt.preventDefault();\r\n\r\n\t\t\tcurId = Tools.generateUID(\"r\"); //\"r\" for rectangle\r\n\r\n\t\t\tTools.drawAndSend({\r\n\t\t\t\t'type': 'rect',\r\n\t\t\t\t'id': curId,\r\n\t\t\t\t'color': Tools.getColor(),\r\n\t\t\t\t'size': Tools.getSize(),\r\n\t\t\t\t'opacity': Tools.getOpacity(),\r\n\t\t\t\t'x': x,\r\n\t\t\t\t'y': y,\r\n\t\t\t\t'x2': x,\r\n\t\t\t\t'y2': y\r\n\t\t\t});\r\n\r\n\t\t\tcurUpdate.id = curId;\r\n\t\t\tcurUpdate.x = x;\r\n\t\t\tcurUpdate.y = y;\r\n\t\t}\r\n\r\n\t\tfunction move(x, y, evt) {\r\n\t\t\t/*Wait 70ms before adding any point to the currently drawing shape.\r\n\t\t\tThis allows the animation to be smother*/\r\n\t\t\tif (curId !== \"\") {\r\n\t\t\t\tcurUpdate['x2'] = x;\r\n\t\t\t\tcurUpdate['y2'] = y;\r\n\t\t\t\tif (performance.now() - lastTime > 70) {\r\n\t\t\t\t\tTools.drawAndSend(curUpdate);\r\n\t\t\t\t\tlastTime = performance.now();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdraw(curUpdate);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (evt) evt.preventDefault();\r\n\t\t}\r\n\r\n\t\tfunction stop(x, y) {\r\n\t\t\t//Add a last point to the shape\r\n\t\t\tmove(x, y);\r\n\t\t\tcurId = \"\";\r\n\t\t}\r\n\r\n\t\tfunction draw(data) {\r\n\t\t\tswitch (data.type) {\r\n\t\t\t\tcase \"rect\":\r\n\t\t\t\t\tcreateShape(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"update\":\r\n\t\t\t\t\tvar shape = svg.getElementById(data['id']);\r\n\t\t\t\t\tif (!shape) {\r\n\t\t\t\t\t\tconsole.error(\"Straight shape: Hmmm... I received a point of a rect that has not been created (%s).\", data['id']);\r\n\t\t\t\t\t\tcreateShape({ //create a new shape in order not to loose the points\r\n\t\t\t\t\t\t\t\"id\": data['id'],\r\n\t\t\t\t\t\t\t\"x\": data['x2'],\r\n\t\t\t\t\t\t\t\"y\": data['y2']\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdateShape(shape, data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.error(\"Straight shape: Draw instruction with unknown type. \", data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar svg = Tools.svg;\r\n\r\n\t\tfunction createShape(data) {\r\n\t\t\t//Creates a new shape on the canvas, or update a shape that already exists with new information\r\n\t\t\tvar shape = svg.getElementById(data.id) || Tools.createSVGElement(\"rect\");\r\n\t\t\tshape.id = data.id;\r\n\t\t\tupdateShape(shape, data);\r\n\t\t\t//If some data is not provided, choose default value. The shape may be updated later\r\n\t\t\tshape.setAttribute(\"stroke\", data.color || \"black\");\r\n\t\t\tshape.setAttribute(\"stroke-width\", data.size || 10);\r\n\t\t\tshape.setAttribute(\"opacity\", Math.max(0.1, Math.min(1, data.opacity)) || 1);\r\n\t\t\tsvg.appendChild(shape);\r\n\t\t\treturn shape;\r\n\t\t}\r\n\r\n\t\tfunction updateShape(shape, data) {\r\n\t\t\tshape.x.baseVal.value = Math.min(data['x2'], data['x']);\r\n\t\t\tshape.y.baseVal.value = Math.min(data['y2'], data['y']);\r\n\t\t\tshape.width.baseVal.value = Math.abs(data['x2'] - data['x']);\r\n\t\t\tshape.height.baseVal.value = Math.abs(data['y2'] - data['y']);\r\n\t\t}\r\n\r\n\t\tTools.add({ //The new tool\r\n\t\t\t\"name\": \"Rectangle\",\r\n\t\t\t\"listeners\": {\r\n\t\t\t\t\"press\": start,\r\n\t\t\t\t\"move\": move,\r\n\t\t\t\t\"release\": stop,\r\n\t\t\t},\r\n\t\t\t\"draw\": draw\r\n\t\t});\r\n\r\n\t})(); //End of code isolation\r\n\r\n\r\n\r\n\t//////////////////////////////////////////////////////////////////////////////////////\r\n\t/////////////////    ERASER    ////////////////////////////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\t(function eraser() { //Code isolation\r\n\r\n\t\tvar erasing = false;\r\n\r\n\t\tfunction startErasing(x, y, evt) {\r\n\t\t\t//Prevent the press from being interpreted by the browser\r\n\t\t\tevt.preventDefault();\r\n\t\t\terasing = true;\r\n\t\t\terase(x, y, evt);\r\n\t\t}\r\n\r\n\t\tvar msg = {\r\n\t\t\t\"type\": \"delete\",\r\n\t\t\t\"id\": \"\"\r\n\t\t};\r\n\r\n\t\tfunction erase(x, y, evt) {\r\n\t\t\t// evt.target should be the element over which the mouse is...\r\n\t\t\tvar target = evt.target;\r\n\t\t\tif (evt.type === \"touchmove\") {\r\n\t\t\t\t// ... the target of touchmove events is the element that was initially touched,\r\n\t\t\t\t// not the one **currently** being touched\r\n\t\t\t\tvar touch = evt.touches[0];\r\n\t\t\t\ttarget = document.elementFromPoint(touch.clientX, touch.clientY);\r\n\t\t\t}\r\n\t\t\tif (erasing && target !== Tools.svg) {\r\n\t\t\t\tmsg.id = target.id;\r\n\t\t\t\tTools.drawAndSend(msg);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction stopErasing() {\r\n\t\t\terasing = false;\r\n\t\t}\r\n\r\n\t\tfunction draw(data) {\r\n\t\t\tvar elem;\r\n\t\t\tswitch (data.type) {\r\n\t\t\t\t//TODO: add the ability to erase only some points in a line\r\n\t\t\t\tcase \"delete\":\r\n\t\t\t\t\telem = svg.getElementById(data.id);\r\n\t\t\t\t\tif (elem === null) console.error(\"Eraser: Tried to delete an element that does not exist.\");\r\n\t\t\t\t\telse svg.removeChild(elem);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.error(\"Eraser: 'delete' instruction with unknown type. \", data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar svg = Tools.svg;\r\n\r\n\t\tTools.add({ //The new tool\r\n\t\t\t\"name\": \"Eraser\",\r\n\t\t\t\"listeners\": {\r\n\t\t\t\t\"press\": startErasing,\r\n\t\t\t\t\"move\": erase,\r\n\t\t\t\t\"release\": stopErasing,\r\n\t\t\t},\r\n\t\t\t\"draw\": draw\r\n\t\t});\r\n\r\n\t})(); //End of code isolation\r\n\r\n\r\n\r\n\t//////////////////////////////////////////////////////////////////////////////////////\r\n\t/////////////////    TEXT    ////////////////////////////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\t(function () { //Code isolation\r\n\t\tvar board = Tools.board,\r\n\t\t\tsvg = Tools.svg;\r\n\r\n\t\tvar input = document.createElement(\"input\");\r\n\t\tinput.id = \"textToolInput\";\r\n\t\tinput.setAttribute(\"autocomplete\", \"off\");\r\n\r\n\t\tvar curText = {\r\n\t\t\t\"x\": 0,\r\n\t\t\t\"y\": 0,\r\n\t\t\t\"size\": 0,\r\n\t\t\t\"opacity\": 1,\r\n\t\t\t\"color\": \"#000\",\r\n\t\t\t\"id\": 0,\r\n\t\t\t\"sentText\": \"\",\r\n\t\t\t\"lastSending\": 0\r\n\t\t};\r\n\r\n\t\tfunction clickHandler(x, y, evt) {\r\n\t\t\tif (evt.target === input) return;\r\n\t\t\tif (evt.target.tagName === \"text\") {\r\n\t\t\t\teditOldText(evt.target);\r\n\t\t\t\tevt.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcurText.size = parseInt(Tools.getSize() * 1.5 + 12);\r\n\t\t\tcurText.opacity = Tools.getOpacity();\r\n\t\t\tcurText.color = Tools.getColor();\r\n\t\t\tcurText.x = x;\r\n\t\t\tcurText.y = y + curText.size / 2;\r\n\r\n\t\t\tdrawCurText();\r\n\t\t\tevt.preventDefault();\r\n\t\t}\r\n\r\n\t\tfunction editOldText(elem) {\r\n\t\t\tcurText.id = elem.id;\r\n\t\t\tcurText.x = elem.x.baseVal[0].value;\r\n\t\t\tcurText.y = elem.y.baseVal[0].value;\r\n\t\t\tcurText.size = parseInt(elem.getAttribute(\"font-size\"));\r\n\t\t\tcurText.opacity = parseFloat(elem.getAttribute(\"opacity\"));\r\n\t\t\tcurText.color = elem.getAttribute(\"fill\");\r\n\t\t\tstartEdit();\r\n\t\t\tinput.value = elem.textContent;\r\n\t\t}\r\n\r\n\t\tfunction drawCurText() {\r\n\t\t\tstopEdit();\r\n\t\t\t//If the user clicked where there was no text, then create a new text field\r\n\t\t\tcurText.id = Tools.generateUID(\"t\"); //\"t\" for text\r\n\t\t\tTools.drawAndSend({\r\n\t\t\t\t'type': 'new',\r\n\t\t\t\t'id': curText.id,\r\n\t\t\t\t'color': curText.color,\r\n\t\t\t\t'size': curText.size,\r\n\t\t\t\t'opacity': curText.opacity,\r\n\t\t\t\t'x': curText.x,\r\n\t\t\t\t'y': curText.y\r\n\t\t\t});\r\n\t\t\tstartEdit();\r\n\t\t}\r\n\r\n\t\tfunction startEdit() {\r\n\t\t\tif (!input.parentNode) board.appendChild(input);\r\n\t\t\tinput.value = \"\";\r\n\t\t\tinput.focus();\r\n\t\t\tinput.addEventListener(\"keyup\", textChangeHandler);\r\n\t\t\tinput.addEventListener(\"blur\", textChangeHandler);\r\n\t\t}\r\n\r\n\t\tfunction stopEdit() {\r\n\t\t\tinput.blur();\r\n\t\t\tinput.removeEventListener(\"keyup\", textChangeHandler);\r\n\t\t}\r\n\r\n\t\tfunction textChangeHandler(evt) {\r\n\t\t\tif (evt.which === 13) {\r\n\t\t\t\tcurText.y += 1.5 * curText.size;\r\n\t\t\t\treturn drawCurText();\r\n\t\t\t}\r\n\t\t\tif (performance.now() - curText.lastSending > 100) {\r\n\t\t\t\tif (curText.sentText !== input.value) {\r\n\t\t\t\t\tTools.drawAndSend({\r\n\t\t\t\t\t\t'type': \"update\",\r\n\t\t\t\t\t\t'id': curText.id,\r\n\t\t\t\t\t\t'txt': input.value.slice(0, 280)\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcurText.sentText = input.value;\r\n\t\t\t\t\tcurText.lastSending = performance.now();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tclearTimeout(curText.timeout);\r\n\t\t\t\tcurText.timeout = setTimeout(textChangeHandler, 500, evt);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction draw(data, isLocal) {\r\n\t\t\tswitch (data.type) {\r\n\t\t\t\tcase \"new\":\r\n\t\t\t\t\tcreateTextField(data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"update\":\r\n\t\t\t\t\tvar textField = document.getElementById(data.id);\r\n\t\t\t\t\tif (textField === null) {\r\n\t\t\t\t\t\tconsole.error(\"Text: Hmmm... I received text that belongs to an unknown text field\");\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdateText(textField, data.txt);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.error(\"Text: Draw instruction with unknown type. \", data);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction updateText(textField, text) {\r\n\t\t\ttextField.textContent = text;\r\n\t\t}\r\n\r\n\t\tfunction createTextField(fieldData) {\r\n\t\t\tvar elem = Tools.createSVGElement(\"text\");\r\n\t\t\telem.id = fieldData.id;\r\n\t\t\telem.setAttribute(\"x\", fieldData.x);\r\n\t\t\telem.setAttribute(\"y\", fieldData.y);\r\n\t\t\telem.setAttribute(\"font-size\", fieldData.size);\r\n\t\t\telem.setAttribute(\"fill\", fieldData.color);\r\n\t\t\telem.setAttribute(\"opacity\", Math.max(0.1, Math.min(1, fieldData.opacity)) || 1);\r\n\t\t\tif (fieldData.txt) elem.textContent = fieldData.txt;\r\n\t\t\tsvg.appendChild(elem);\r\n\t\t\treturn elem;\r\n\t\t}\r\n\r\n\t\tTools.add({ //The new tool\r\n\t\t\t\"name\": \"Text\",\r\n\t\t\t\"listeners\": {\r\n\t\t\t\t\"press\": clickHandler,\r\n\t\t\t},\r\n\t\t\t\"draw\": draw\r\n\t\t});\r\n\r\n\t})(); //End of code isolation\r\n\r\n\r\n\t//////////////////////////////////////////////////////////////////////////////////////\r\n\t/////////////////    HAND   ////////////////////////////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////////////////\r\n/*\r\n\t(function () { //Code isolation\r\n\r\n\t\tvar orig = {\r\n\t\t\tx: 0,\r\n\t\t\ty: 0\r\n\t\t};\r\n\t\tvar pressed = false;\r\n\r\n\t\tfunction press(x, y, evt, isTouchEvent) {\r\n\t\t\tif (!isTouchEvent) {\r\n\t\t\t\tpressed = true;\r\n\t\t\t\torig.x = window.scrollX + evt.clientX;\r\n\t\t\t\torig.y = window.scrollY + evt.clientY;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction move(x, y, evt, isTouchEvent) {\r\n\t\t\tif (pressed && !isTouchEvent) { //Let the browser handle touch to scroll\r\n\t\t\t\twindow.scrollTo(orig.x - evt.clientX, orig.y - evt.clientY);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction release() {\r\n\t\t\tpressed = false;\r\n\t\t}\r\n\r\n\t\tTools.add({ //The new tool\r\n\t\t\t\"name\": \"Hand\",\r\n\t\t\t\"listeners\": {\r\n\t\t\t\t\"press\": press,\r\n\t\t\t\t\"move\": move,\r\n\t\t\t\t\"release\": release\r\n\t\t\t},\r\n\t\t\t\"mouseCursor\": \"move\"\r\n\t\t});\r\n\r\n\t\t//The hand tool is selected by default\r\n\t\tTools.change(\"Hand\");\r\n\t})(); //End of code isolation\r\n\r\n\r\n\t//////////////////////////////////////////////////////////////////////////////////////\r\n\t/////////////////    ZOOM    ////////////////////////////////////////////////////////\r\n\t///////////////////////////////////////////////////////////////////////////////////////\r\n\r\n\t(function () { //Code isolation\r\n\t\tvar ZOOM_FACTOR = .1;\r\n\t\tvar origin = {\r\n\t\t\tscrollX: window.scrollX,\r\n\t\t\tscrollY: window.scrollY,\r\n\t\t\tx: 0.0,\r\n\t\t\ty: 0.0,\r\n\t\t\tclientY: 0,\r\n\t\t\tscale: 1.0\r\n\t\t};\r\n\t\tvar moved = false,\r\n\t\t\tpressed = false;\r\n\r\n\t\tfunction zoom(origin, scale) {\r\n\t\t\tvar oldScale = origin.scale;\r\n\t\t\tvar newScale = Tools.setScale(scale);\r\n\t\t\twindow.scrollTo(\r\n\t\t\t\torigin.scrollX + origin.x * (newScale - oldScale),\r\n\t\t\t\torigin.scrollY + origin.y * (newScale - oldScale)\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tvar animation = null;\r\n\r\n\t\tfunction animate(scale) {\r\n\t\t\tcancelAnimationFrame(animation);\r\n\t\t\tanimation = requestAnimationFrame(function () {\r\n\t\t\t\tzoom(origin, scale);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction setOrigin(x, y, evt, isTouchEvent) {\r\n\t\t\torigin.scrollX = window.scrollX;\r\n\t\t\torigin.scrollY = window.scrollY;\r\n\t\t\torigin.x = x;\r\n\t\t\torigin.y = y;\r\n\t\t\torigin.clientY = getClientY(evt, isTouchEvent);\r\n\t\t\torigin.scale = Tools.getScale();\r\n\t\t}\r\n\r\n\t\tfunction press(x, y, evt, isTouchEvent) {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tsetOrigin(x, y, evt, isTouchEvent);\r\n\t\t\tmoved = false;\r\n\t\t\tpressed = true;\r\n\t\t}\r\n\r\n\t\tfunction move(x, y, evt, isTouchEvent) {\r\n\t\t\tif (pressed) {\r\n\t\t\t\tevt.preventDefault();\r\n\t\t\t\tvar delta = getClientY(evt, isTouchEvent) - origin.clientY;\r\n\t\t\t\tvar scale = origin.scale * (1 + delta * ZOOM_FACTOR / 100);\r\n\t\t\t\tif (Math.abs(delta) > 1) moved = true;\r\n\t\t\t\tanimation = animate(scale);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onwheel(evt) {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tif (evt.ctrlKey || Tools.curTool === zoomTool) {\r\n\t\t\t\tvar scale = Tools.getScale();\r\n\t\t\t\tvar x = evt.pageX / scale;\r\n\t\t\t\tvar y = evt.pageY / scale;\r\n\t\t\t\tsetOrigin(x, y, evt, false);\r\n\t\t\t\tanimate((1 - evt.deltaY * ZOOM_FACTOR / 10) * Tools.getScale());\r\n\t\t\t} else {\r\n\t\t\t\twindow.scrollTo(window.scrollX + evt.deltaX, window.scrollY + evt.deltaY);\r\n\t\t\t}\r\n\t\t}\r\n\t\tTools.board.addEventListener(\"wheel\", onwheel, {\r\n\t\t\tpassive: false\r\n\t\t});\r\n\r\n\t\tTools.board.addEventListener(\"touchmove\", function ontouchmove(evt) {\r\n\t\t\t// 2-finger pan to zoom\r\n\t\t\tvar touches = evt.touches;\r\n\t\t\tif (touches.length === 2) {\r\n\t\t\t\tvar x0 = touches[0].clientX,\r\n\t\t\t\t\tx1 = touches[1].clientX,\r\n\t\t\t\t\ty0 = touches[0].clientY,\r\n\t\t\t\t\ty1 = touches[1].clientY,\r\n\t\t\t\t\tdx = x0 - x1,\r\n\t\t\t\t\tdy = y0 - y1;\r\n\t\t\t\tvar x = (touches[0].pageX + touches[1].pageX) / 2 / Tools.getScale(),\r\n\t\t\t\t\ty = (touches[0].pageY + touches[1].pageY) / 2 / Tools.getScale();\r\n\t\t\t\tvar distance = Math.sqrt(dx * dx + dy * dy);\r\n\t\t\t\tif (!pressed) {\r\n\t\t\t\t\tpressed = true;\r\n\t\t\t\t\tsetOrigin(x, y, evt, true);\r\n\t\t\t\t\torigin.distance = distance;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar delta = distance - origin.distance;\r\n\t\t\t\t\tvar scale = origin.scale * (1 + delta * ZOOM_FACTOR / 100);\r\n\t\t\t\t\tanimate(scale);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\tpassive: true\r\n\t\t});\r\n\r\n\t\tfunction touchend() {\r\n\t\t\tpressed = false;\r\n\t\t}\r\n\t\tTools.board.addEventListener(\"touchend\", touchend);\r\n\t\tTools.board.addEventListener(\"touchcancel\", touchend);\r\n\r\n\t\tfunction release(x, y, evt, isTouchEvent) {\r\n\t\t\tif (pressed && !moved) {\r\n\t\t\t\tvar delta = (evt.shiftKey === true) ? -1 : 1;\r\n\t\t\t\tvar scale = Tools.getScale() * (1 + delta * ZOOM_FACTOR);\r\n\t\t\t\tzoom(origin, scale);\r\n\t\t\t}\r\n\t\t\tpressed = false;\r\n\t\t}\r\n\r\n\t\tfunction key(down) {\r\n\t\t\treturn function (evt) {\r\n\t\t\t\tif (evt.key === \"Shift\") {\r\n\t\t\t\t\tTools.svg.style.cursor = \"zoom-\" + (down ? \"out\" : \"in\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction getClientY(evt, isTouchEvent) {\r\n\t\t\treturn isTouchEvent ? evt.changedTouches[0].clientY : evt.clientY;\r\n\t\t}\r\n\r\n\t\tvar keydown = key(true);\r\n\t\tvar keyup = key(false);\r\n\r\n\t\tfunction onstart() {\r\n\t\t\twindow.addEventListener(\"keydown\", keydown);\r\n\t\t\twindow.addEventListener(\"keyup\", keyup);\r\n\t\t}\r\n\r\n\t\tfunction onquit() {\r\n\t\t\twindow.removeEventListener(\"keydown\", keydown);\r\n\t\t\twindow.removeEventListener(\"keyup\", keyup);\r\n\t\t}\r\n\r\n\t\tvar zoomTool = {\r\n\t\t\t\"name\": \"Zoom\",\r\n\t\t\t\"listeners\": {\r\n\t\t\t\t\"press\": press,\r\n\t\t\t\t\"move\": move,\r\n\t\t\t\t\"release\": release,\r\n\t\t\t},\r\n\t\t\t\"onstart\": onstart,\r\n\t\t\t\"onquit\": onquit,\r\n\t\t\t\"mouseCursor\": \"zoom-in\",\r\n\t\t\t\"helpText\": \"Click to zoom in\\nPress shift and click to zoom out\",\r\n\t\t};\r\n\t\tTools.add(zoomTool);\r\n\t})(); //End of code isolation\r\n*/\r\n\r\n}\r\n\r\nexport default toolScript;","import pathPolyfill from './path-data-polyfill';\r\nimport toolScript from './toolsScript';\r\n\r\nconst board = (socket, boardId) => {\r\n\r\n\t// Define the canvas real size\r\n\t\r\n\tconst MAX_HEIGHT = 3000;\r\n\tconst MAX_WIDTH = 1.6*MAX_HEIGHT;\r\n\r\n\tpathPolyfill();\r\n\tvar Tools = {};\r\n\tTools.board = document.getElementById(\"board\");\r\n\tTools.svg = document.getElementById(\"canvas\");\r\n\tTools.socket = socket;\r\n\tTools.curTool = null;\r\n\tTools.boardName = boardId;\r\n\r\n\tTools.setScale = function setScale(scale) {\r\n\t\tif (isNaN(scale)) scale = 1;\r\n\t\tscale = Math.max(0.1, Math.min(10, scale));\r\n\t\tTools.svg.style.willChange = 'transform';\r\n\t\tTools.svg.style.transform = 'scale(' + scale + ')';\r\n\r\n\r\n\t\tTools.scale = scale;\r\n\t\treturn scale;\r\n\t}\r\n\r\n\r\n\tTools.list = {}; // An array of all known tools. {\"toolName\" : {toolObject}}\r\n\r\n\tTools.add = function (newTool) {\r\n\t\tif (newTool.name in Tools.list) {\r\n\t\t\t//console.log(\"Tools.add: The tool '\" + newTool.name + \"' is already\" +\t\"in the list. Updating it...\");\r\n\t\t}\r\n\r\n\t\t//Add event listener for the tool's icon\r\n\t\tconst button = document.getElementById(newTool.name);\r\n\t\tif (button) {\r\n\t\t\tbutton.addEventListener('click', function () {\r\n\t\t\t\tTools.change(button.id);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t//Format the new tool correctly\r\n\t\tTools.applyHooks(Tools.toolHooks, newTool);\r\n\r\n\t\t//Add the tool to the list\r\n\t\tTools.list[newTool.name] = newTool;\r\n\r\n\t\t//There may be pending messages for the tool\r\n\t\tvar pending = Tools.pendingMessages[newTool.name];\r\n\t\tif (pending) {\r\n\t\t\t//console.log(\"Drawing pending messages for '%s'.\", newTool.name);\r\n\t\t\tvar msg;\r\n\t\t\twhile (msg = pending.shift()) {\r\n\t\t\t\t//Transmit the message to the tool (precising that it comes from the network)\r\n\t\t\t\tnewTool.draw(msg, false);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tTools.change = function (toolName) {\r\n\t\tif (!(toolName in Tools.list)) {\r\n\t\t\t//console.log(\"Trying to select a tool that has never been added!\");\r\n\t\t}\r\n\r\n\t\tvar newtool = Tools.list[toolName];\r\n\r\n\r\n\t\t//There is not necessarily already a curTool\r\n\t\tif (Tools.curTool != null) {\r\n\t\t\t//It's useless to do anything if the new tool is already selected\r\n\t\t\tif (newtool === Tools.curTool) return;\r\n\r\n\t\t\t//Remove the old event listeners\r\n\t\t\tfor (var event in Tools.curTool.compiledListeners) {\r\n\t\t\t\tvar listener = Tools.curTool.compiledListeners[event];\r\n\t\t\t\tTools.board.removeEventListener(event, listener);\r\n\t\t\t}\r\n\r\n\t\t\t//Call the callbacks of the old tool\r\n\t\t\tTools.curTool.onquit(newtool);\r\n\t\t}\r\n\r\n\t\t//Add the new event listeners\r\n\t\tfor (event in newtool.compiledListeners) {\r\n\t\t\tlistener = newtool.compiledListeners[event];\r\n\t\t\tTools.board.addEventListener(event, listener, {\r\n\t\t\t\t'passive': false\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t//Call the start callback of the new tool \r\n\t\tnewtool.onstart(Tools.curTool);\r\n\t\tTools.curTool = newtool;\r\n\t};\r\n\r\n\tTools.send = function (data, toolName) {\r\n\t\ttoolName = toolName || Tools.curTool.name;\r\n\t\tvar d = data;\r\n\t\td.tool = toolName;\r\n\t\tTools.applyHooks(Tools.messageHooks, d);\r\n\t\tvar message = {\r\n\t\t\t\"board\": Tools.boardName,\r\n\t\t\t\"data\": d\r\n\t\t}\r\n\t\tTools.socket.emit('broadcast', message);\r\n\t};\r\n\r\n\tTools.drawAndSend = function (data) {\r\n\t\tTools.curTool.draw(data, true);\r\n\t\tTools.send(data);\r\n\t};\r\n\r\n\t//Object containing the messages that have been received before the corresponding tool\r\n\t//is loaded. keys : the name of the tool, values : array of messages for this tool\r\n\tTools.pendingMessages = {};\r\n\r\n\t// Send a message to the corresponding tool\r\n\tfunction messageForTool(message) {\r\n\t\tvar name = message.tool,\r\n\t\t\ttool = Tools.list[name];\r\n\t\tif (tool) {\r\n\t\t\tTools.applyHooks(Tools.messageHooks, message);\r\n\t\t\ttool.draw(message, false);\r\n\t\t} else {\r\n\t\t\t///We received a message destinated to a tool that we don't have\r\n\t\t\t//So we add it to the pending messages\r\n\t\t\tif (!Tools.pendingMessages[name]) Tools.pendingMessages[name] = [message];\r\n\t\t\telse Tools.pendingMessages[name].push(message);\r\n\t\t}\r\n\t}\r\n\r\n\t// Apply the function to all arguments by batches\r\n\tfunction batchCall(fn, args) {\r\n\t\tvar BATCH_SIZE = 1024;\r\n\t\tif (args.length > 0) {\r\n\t\t\tvar batch = args.slice(0, BATCH_SIZE);\r\n\t\t\tvar rest = args.slice(BATCH_SIZE);\r\n\t\t\tfor (var i = 0; i < batch.length; i++) fn(batch[i]);\r\n\t\t\trequestAnimationFrame(batchCall.bind(null, fn, rest));\r\n\t\t}\r\n\t}\r\n\r\n\t// Call messageForTool recursively on the message and its children\r\n\tfunction handleMessage(message) {\r\n\t\t//Check if the message is in the expected format\r\n\t\tif (message.tool) messageForTool(message);\r\n\t\tif (message._children) batchCall(handleMessage, message._children);\r\n\t\tif (!message.tool && !message._children) {\r\n\t\t\tconsole.error(\"Received a badly formatted message (no tool). \", message);\r\n\t\t}\r\n\t}\r\n\r\n\t//Receive draw instructions from the server\r\n\tTools.socket.on(\"broadcast\", handleMessage);\r\n\r\n\tTools.messageHooks = [];\r\n\r\n\t// Tools.scale = 1.0;\r\n\t// var scaleTimeout = null;\r\n\r\n\tTools.getScale = function getScale() {\r\n\t\treturn Tools.scale;\r\n\t}\r\n\r\n\t//List of hook functions that will be applied to tools before adding them\r\n\tTools.toolHooks = [\r\n\t\tfunction checkToolAttributes(tool) {\r\n\t\t\tif (typeof (tool.name) !== \"string\") throw \"A tool must have a name\";\r\n\t\t\tif (typeof (tool.listeners) !== \"object\") {\r\n\t\t\t\ttool.listeners = {};\r\n\t\t\t}\r\n\t\t\tif (typeof (tool.onstart) !== \"function\") {\r\n\t\t\t\ttool.onstart = function () {};\r\n\t\t\t}\r\n\t\t\tif (typeof (tool.onquit) !== \"function\") {\r\n\t\t\t\ttool.onquit = function () {};\r\n\t\t\t}\r\n\t\t},\r\n\t\tfunction compileListeners(tool) {\r\n\t\t\t//compile listeners into compiledListeners\r\n\t\t\tvar listeners = tool.listeners;\r\n\r\n\t\t\t//A tool may provide precompiled listeners\r\n\t\t\tvar compiled = tool.compiledListeners || {};\r\n\t\t\ttool.compiledListeners = compiled;\r\n\r\n\t\t\tfunction compile(listener) { //closure\r\n\t\t\t\tconst xOffset = document.getElementById('boardContainer').offsetLeft;\r\n\t\t\t\tconst yOffset = document.getElementById('boardContainer').offsetTop;\r\n\r\n\t\t\t\treturn (function listen(evt) {\r\n\t\t\t\t\tvar x = (evt.pageX - xOffset) / Tools.getScale(),\r\n\t\t\t\t\t\ty = (evt.pageY - yOffset) / Tools.getScale();\r\n\t\t\t\t\treturn listener(x, y, evt, false);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction compileTouch(listener) { //closure\r\n\t\t\t\tconst xOffset = document.getElementById('boardContainer').offsetLeft;\r\n\t\t\t\tconst yOffset = document.getElementById('boardContainer').offsetTop;\r\n\t\t\t\treturn (function touchListen(evt) {\r\n\t\t\t\t\t//Currently, we don't handle multitouch\r\n\t\t\t\t\tif (evt.changedTouches.length === 1) {\r\n\t\t\t\t\t\t//evt.preventDefault();\r\n\t\t\t\t\t\tvar touch = evt.changedTouches[0];\r\n\t\t\t\t\t\tvar x = (touch.pageX - xOffset) / Tools.getScale(),\r\n\t\t\t\t\t\t\ty = (touch.pageY - yOffset) / Tools.getScale();\r\n\t\t\t\t\t\treturn listener(x, y, evt, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (listeners.press) {\r\n\t\t\t\tcompiled[\"mousedown\"] = compile(listeners.press);\r\n\t\t\t\tcompiled[\"touchstart\"] = compileTouch(listeners.press);\r\n\t\t\t}\r\n\t\t\tif (listeners.move) {\r\n\t\t\t\tcompiled[\"mousemove\"] = compile(listeners.move);\r\n\t\t\t\tcompiled[\"touchmove\"] = compileTouch(listeners.move);\r\n\t\t\t}\r\n\t\t\tif (listeners.release) {\r\n\t\t\t\tvar release = compile(listeners.release),\r\n\t\t\t\t\treleaseTouch = compileTouch(listeners.release);\r\n\t\t\t\tcompiled[\"mouseup\"] = release;\r\n\t\t\t\tcompiled[\"mouseleave\"] = release;\r\n\t\t\t\tcompiled[\"touchleave\"] = releaseTouch;\r\n\t\t\t\tcompiled[\"touchend\"] = releaseTouch;\r\n\t\t\t\tcompiled[\"touchcancel\"] = releaseTouch;\r\n\t\t\t}\r\n\t\t}\r\n\t];\r\n\r\n\tTools.applyHooks = function (hooks, object) {\r\n\t\t//Apply every hooks on the object\r\n\t\thooks.forEach(function (hook) {\r\n\t\t\thook(object);\r\n\t\t});\r\n\t};\r\n\r\n\r\n\t// Utility functions\r\n\r\n\tTools.generateUID = function (prefix, suffix) {\r\n\t\tvar uid = Date.now().toString(36); //Create the uids in chronological order\r\n\t\tuid += (Math.round(Math.random() * 36)).toString(36); //Add a random character at the end\r\n\t\tif (prefix) uid = prefix + uid;\r\n\t\tif (suffix) uid = uid + suffix;\r\n\t\treturn uid;\r\n\t};\r\n\r\n\tTools.createSVGElement = function (name) {\r\n\t\treturn document.createElementNS(Tools.svg.namespaceURI, name);\r\n\t};\r\n\r\n\tTools.positionElement = function (elem, x, y) {\r\n\t\telem.style.top = y + \"px\";\r\n\t\telem.style.left = x + \"px\";\r\n\t};\r\n\r\n\tTools.getColor = (function color() {\r\n\t\tvar chooser = document.getElementById(\"chooseColor\");\r\n\t\t// Init with a random color\r\n\t\tvar clrs = [\"#001f3f\", \"#0074D9\", \"#7FDBFF\", \"#39CCCC\", \"#3D9970\",\r\n\t\t\t\"#2ECC40\", \"#01FF70\", \"#FFDC00\", \"#FF851B\", \"#FF4136\",\r\n\t\t\t\"#85144b\", \"#F012BE\", \"#B10DC9\", \"#111111\", \"#AAAAAA\"\r\n\t\t];\r\n\t\tchooser.value = clrs[Math.random() * clrs.length | 0];\r\n\t\treturn function () {\r\n\t\t\treturn chooser.value;\r\n\t\t};\r\n\t})();\r\n\r\n\tTools.getSize = (function size() {\r\n\t\tvar chooser = document.getElementById(\"chooseSize\");\r\n\r\n\t\tfunction update() {\r\n\t\t\tif (chooser.value < 1 || chooser.value > 50) {\r\n\t\t\t\tchooser.value = 3;\r\n\t\t\t}\r\n\t\t}\r\n\t\tupdate();\r\n\r\n\t\tchooser.onchange = update;\r\n\t\treturn function () {\r\n\t\t\treturn chooser.value;\r\n\t\t};\r\n\t})();\r\n\r\n\tTools.getOpacity = (function opacity() {\r\n\t\tvar chooser = document.getElementById(\"chooseOpacity\");\r\n\t\treturn function () {\r\n\t\t\treturn Math.max(0.1, Math.min(1, chooser.value));\r\n\t\t};\r\n\t})();\r\n\r\n\t// Set scale depending on screen size\r\n\tconst setCanvasScale = () => {\r\n\t\t//console.log('set canvas scale');\r\n\t\tlet scaleToSet;\r\n\t\tconst sizeRatio = MAX_HEIGHT / MAX_WIDTH;\r\n\t\t// Get screen size\r\n\t\tconst canvasContainer = document.getElementById('boardContainer');\r\n\t\tconst containerWidth = canvasContainer.clientWidth;\r\n\t\tconst containerHeight = canvasContainer.clientHeight;\r\n\r\n\t\t// if screen size is bigger than canvas size => scale = 1\r\n\t\tif (containerHeight >= MAX_HEIGHT && containerWidth >= MAX_WIDTH) {\r\n\t\t\tscaleToSet = 1;\r\n\t\t} else {\r\n\t\t\t// Determine whether to scale based on width or height\t\r\n\t\t\tif ((containerHeight / containerWidth) <= sizeRatio) {\r\n\t\t\t\t// Scale on height\r\n\t\t\t\tscaleToSet = containerHeight / MAX_HEIGHT;\r\n\t\t\t} else {\r\n\t\t\t\t// Scale on width\r\n\t\t\t\tscaleToSet = containerWidth / MAX_WIDTH;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Set canvas size to screen size\r\n\t\tTools.svg.width.baseVal.value = MAX_WIDTH;\r\n\t\tTools.svg.height.baseVal.value = MAX_HEIGHT;\r\n\t\tTools.setScale(scaleToSet);\r\n\t\t// Correct the position back to top left corner\r\n\t\tTools.svg.style.top = `-${(1-scaleToSet)*0.5*MAX_HEIGHT}`;\r\n\t\tTools.svg.style.left = `-${(1-scaleToSet)*0.5*MAX_WIDTH}`;\r\n\t}\r\n\r\n\t// Listen for any window size change\r\n\twindow.addEventListener('resize', setCanvasScale);\r\n\t//Scale the canvas on load\r\n\tsetCanvasScale();\r\n\t//Get the board once the canvas is scaled\r\n\tTools.socket.emit(\"getboard\", Tools.boardName);\r\n\r\n\r\n\r\n\t/***********  Polyfills  ***********/\r\n\tif (!window.performance || !window.performance.now) {\r\n\t\twindow.performance = {\r\n\t\t\t\"now\": Date.now\r\n\t\t}\r\n\t}\r\n\tif (!Math.hypot) {\r\n\t\tMath.hypot = function (x, y) {\r\n\t\t\t//The true Math.hypot accepts any number of parameters\r\n\t\t\treturn Math.sqrt(x * x + y * y);\r\n\t\t}\r\n\t}\r\n\r\n\t// Set up the tools\r\n\ttoolScript(Tools);\r\n\r\n\r\n}\r\n\r\nexport default board;\r\n\r\n\r\n\r\n/**\r\nWhat does a \"tool\" object look like?\r\nnewtool = {\r\n\t\"name\" : \"SuperTool\",\r\n\t\"listeners\" : {\r\n\t\t\"press\" : function(x,y,evt){...},\r\n\t\t\"move\" : function(x,y,evt){...},\r\n\t\t\"release\" : function(x,y,evt){...},\r\n\t},\r\n\t\"draw\" : function(data, isLocal){\r\n\t\t//Print the data on Tools.svg\r\n\t},\r\n\t\"onstart\" : function(oldTool){...},\r\n\t\"onquit\" : function(newTool){...},\r\n\t\"stylesheet\" : \"style.css\",\r\n}\r\n*/","import adapter from 'webrtc-adapter';\r\n\r\nconst webRTC = (socket, boardReady, servers) => {\r\n    console.log(servers.iceServers);\r\n    // Setup video containers\r\n    const localVideo = document.getElementById('localVideo');\r\n    const remoteVideo = document.getElementById('remoteVideo');\r\n    // Setup local variables\r\n    let initiator = boardReady\r\n    let localMediaStream = false;\r\n    let localConn = {};\r\n    let remoteTempIceCandidates = [];\r\n    let gotRemoteDesc = false;\r\n    let gotStream = false;\r\n    let gotLocalDescription = false;\r\n    const ICE_config = {\r\n        'iceServers': [{\r\n                'url': 'stun:stun.l.google.com:19302'\r\n            },\r\n            {\r\n                'url': 'turn:192.158.29.39:3478?transport=udp',\r\n                'credential': 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\r\n                'username': '28224511:1379330808'\r\n            },\r\n            {\r\n                'url': 'turn:192.158.29.39:3478?transport=tcp',\r\n                'credential': 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\r\n                'username': '28224511:1379330808'\r\n            }\r\n        ]\r\n    }\r\n\r\n    // Try to get local stream \r\n    const tryVideoChat = () => {\r\n        console.log('trying video');\r\n        window.navigator.getUserMedia({\r\n            audio: true,\r\n            video: true\r\n        }, function (localStream) {\r\n            localMediaStream = localStream;\r\n            localVideo.srcObject = localStream;\r\n            initVideoChat();\r\n        }, function (err) {\r\n            console.error(\"You are not allow navigator use device\", err);\r\n        });\r\n    }\r\n\r\n    const initVideoChat = () => {\r\n        //Setup RTC connnection, add local stream and listen for remote stream\r\n        const setupConnection = () => {\r\n            console.log('setting up connection');\r\n            localConn = new RTCPeerConnection(ICE_config);\r\n            localConn.addStream(localMediaStream);\r\n            localConn.addEventListener('track', gotRemoteStream);\r\n            localConn.onicecandidate = handleLocalIceCandidate;\r\n        };\r\n\r\n        // Starts connection, create & send offer\r\n        const handleVideoInit = () => {\r\n            console.log('peer ready');\r\n            localConn.createOffer(function (desc) {\r\n                // desc is typeof RTCSessionDescription wich contains local's session\r\n                if (!gotLocalDescription) {\r\n                    localConn.setLocalDescription(desc);\r\n                    gotLocalDescription = true;\r\n                    console.log('send desc');\r\n                    socket.emit('OFFER_WEB_RTC', JSON.stringify(desc));\r\n                }\r\n                // send desc to remote\r\n            }, function (err) {\r\n                console.error(err);\r\n            });\r\n        }\r\n\r\n        // Add offer to local connection, create & send answer\r\n        const handleOffer = (remoteDesc) => {\r\n            if (!gotRemoteDesc) {\r\n                console.log('handling offer');\r\n                let remoteTempDesc = JSON.parse(remoteDesc);\r\n                // add remote's description\r\n                localConn.setRemoteDescription(\r\n                        new RTCSessionDescription(remoteTempDesc)\r\n                    )\r\n                    .then(() => {\r\n                        gotRemoteDesc = true;\r\n                        // registerIceCandidates();\r\n                        localConn.createAnswer(function (localDesc) {\r\n                            //if (!gotLocalDescription) {\r\n                            localConn.setLocalDescription(localDesc);\r\n                            gotLocalDescription = true;\r\n                            //}\r\n                            //registerRemoteIceCandidates();\r\n                            socket.emit('RESPONSE_WEB_RTC', localDesc);\r\n\r\n                        }, function (err) {\r\n                            console.log(err);\r\n                        });\r\n                    })\r\n                    .catch(err => console.log(err));\r\n            }\r\n        }\r\n\r\n        // When we receive remote stream, display it in remote video\r\n        const gotRemoteStream = evt => {\r\n            console.log('got remote stream');\r\n            //if (!gotStream) {\r\n            if (remoteVideo.srcObject !== evt.streams[0]) {\r\n                remoteVideo.srcObject = evt.streams[0];\r\n\r\n            }\r\n            //}\r\n        };\r\n\r\n        // Sort ice candidate & send them to remote peer\r\n        const handleLocalIceCandidate = evt => {\r\n            console.log('handling local candidate');\r\n            if (evt.candidate) {\r\n\r\n                // send ice local's iceCandidate to remote\r\n                console.log('send ice candidate')\r\n                socket.emit('CANDIDATE_WEB_RTC', {\r\n                    candidate: evt.candidate\r\n                });\r\n            }\r\n        }\r\n\r\n        // Receives remote ICE candidate to remote candidates array\r\n        const handleRemoteIceCandidate = data => {\r\n            console.log('handling remote candidate');\r\n            if (data.candidate) {\r\n                //if (gotRemoteDesc) {\r\n                localConn.addIceCandidate(\r\n                        new RTCIceCandidate(data.candidate)\r\n                    )\r\n                    .then(() => {\r\n                        console.log('AddIceCandidate success!');\r\n                    })\r\n                    .catch(err => {\r\n                        console.error('Error AddIceCandidate');\r\n                        console.error(err);\r\n                    })\r\n                // } else {\r\n                //     remoteTempIceCandidates.push(data.candidate);\r\n                //}\r\n            }\r\n        }\r\n\r\n        // const registerIceCandidates = remoteTempIceCandidates => {\r\n        //     for (let i = 0; i < remoteTempIceCandidates.length; i++){\r\n        //         localConn.addIceCandidate(\r\n        //             new RTCIceCandidate(remoteTempIceCandidates[i])\r\n        //         )\r\n        //         .then(() => {\r\n        //             console.log('AddIceCandidate success!');\r\n        //         })\r\n        //         .catch(err => {\r\n        //             console.error('Error AddIceCandidate');\r\n        //             console.error(err);\r\n        //         })\r\n        //     }\r\n        // }\r\n\r\n        // First we setup our own connection\r\n        setupConnection();\r\n        //Signal the other peer that we are ready\r\n        if (initiator) setTimeout(socket.emit('RTC_PEER_READY'), 5000);\r\n        // Setup the list of events we expect to receive\r\n        socket.on('RTC_PEER_READY', handleVideoInit);\r\n\r\n        socket.on('CANDIDATE_WEB_RTC', handleRemoteIceCandidate);\r\n\r\n        socket.on('OFFER_WEB_RTC', handleOffer);\r\n\r\n        socket.on('RESPONSE_WEB_RTC', remoteDesc => {\r\n            console.log('got response');\r\n            if (!gotRemoteDesc) {\r\n                localConn.setRemoteDescription(new RTCSessionDescription(remoteDesc));\r\n                gotRemoteDesc = true;\r\n                //registerIceCandidates();\r\n            }\r\n        });\r\n\r\n    }\r\n    // Re-initialize if peer disconnects\r\n    socket.on('PEER_DISCONNECTED', () => {\r\n        console.log(\"peer disconnected\");\r\n        initiator = false;\r\n        gotRemoteDesc = false;\r\n        gotStream = false;\r\n        gotLocalDescription = false;\r\n        remoteVideo.srcObject = null;\r\n        if (localConn !== {}) localConn.close();\r\n        localConn = {};\r\n        remoteTempIceCandidates = [];\r\n        if (localMediaStream !== false) {\r\n            initVideoChat();\r\n        } else {\r\n            tryVideoChat();\r\n        }\r\n\r\n    });\r\n\r\n    // First we setup our own connection & video stream\r\n    tryVideoChat();\r\n\r\n\r\n\r\n\r\n};\r\n\r\nexport default webRTC;","import React from 'react';\r\n\r\nimport './tools.css';\r\n\r\nconst tools = (props) => {\r\n\r\n    const toolList = [\r\n        {\r\n        id: 'Pencil',\r\n        name:'pencil'\r\n    },\r\n        {\r\n        id: 'Rectangle',\r\n        name:'rect'\r\n    },\r\n    //     {\r\n    //     id: 'circle-button',\r\n    //     name:'circle'\r\n    // },\r\n    //     {\r\n    //     id: 'ellipse-button',\r\n    //     name:'ellipse'\r\n    // },\r\n        {\r\n        id: 'Straight line',\r\n        name:'line'\r\n    },\r\n        {\r\n        id: 'Text',\r\n        name:'text'\r\n    },\r\n        {\r\n        id: 'Eraser',\r\n        name:'erase'\r\n    }\r\n    // ,\r\n    //     {\r\n    //     id: 'Zoom',\r\n    //     name:'zoom'\r\n    // }\r\n    // // ,\r\n    //     {\r\n    //     id: 'Hand',\r\n    //     name:'drag'\r\n    // }\r\n    \r\n]\r\n\r\n    let tools = toolList.map(tool => {\r\n        let toolUrl = require(`../../assets/icons/tools/${tool.name}.svg`); \r\n        return (\r\n            <img key={tool.name} src={toolUrl} alt={tool.name} id={tool.id}/>\r\n        );\r\n    });\r\n\r\n    return(\r\n        <div className=\"toolsContainer\">\r\n            {tools}\r\n            <span className=\"form-group\" >\r\n            Colour :\r\n            <br/>\r\n            <input \r\n                id='chooseColor'\r\n                type='color'\r\n                defaultValue='#345678' \r\n            /> \r\n\r\n            </span>\r\n            <label htmlFor=\"chooseSize\" data-translation=\"waiting\">Size</label>\r\n            <input type=\"range\" id=\"chooseSize\" defaultValue=\"10\" min=\"1\" max=\"50\" step=\"1\" className=\"rangeChooser\" />\r\n            <label htmlFor=\"chooseOpacity\" data-translation=\"waiting\">Opacity</label>\r\n            <input type=\"range\" id=\"chooseOpacity\" defaultValue=\"1\" min=\"0.2\" max=\"1\" step=\"0.1\" className=\"rangeChooser\" />\r\n\r\n        </div> \r\n    );\r\n};\r\n\r\nexport default tools;","import React from 'react';\r\nimport './controls.css'\r\n\r\n\r\n\r\nconst controls = (props) => {\r\n    const controlsList = [\r\n        { \r\n            link : 'invite',\r\n            name: 'Inviter',\r\n            click: props.openModal\r\n        },\r\n        { \r\n            link : 'download',\r\n            name: 'Télécharger'\r\n        },\r\n        { \r\n            link : 'file',\r\n            name: 'Fichier'\r\n        },\r\n        { \r\n            link : 'info',\r\n            name: 'Aide'\r\n        },\r\n        { \r\n            link : 'microphone',\r\n            name: 'Micro On'\r\n        },\r\n        { \r\n            link : 'camera',\r\n            name: 'Vidéo On'\r\n        },\r\n    ];\r\n\r\n    let controlItems = controlsList.map((control) => {\r\n        let imgUrl=require(`../../assets/icons/controls/${control.link}.svg`);\r\n        if (control.click) {\r\n            return(\r\n                <li onClick={control.click} key={control.link} className='control' id={control.link} >\r\n                    <img src={imgUrl} alt={control.link}/>\r\n                    <span className='toolText'>{control.name}</span>\r\n                </li>\r\n            );        \r\n        } else {\r\n            return(\r\n                <li key={control.link} className='control' id={control.link} >\r\n                    <img src={imgUrl} alt={control.link}/>\r\n                    <span className='toolText'>{control.name}</span>\r\n                </li>\r\n            );    \r\n        }\r\n    });\r\n\r\n    return(\r\n        <div className=\"controlsContainer\">\r\n            <ul id='controls'>\r\n                {controlItems}\r\n            </ul>\r\n            <video autoPlay id=\"remoteVideo\"></video>\r\n            <video autoPlay muted id=\"localVideo\"></video>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default controls;","import React from 'react';\r\nimport './modal.css';\r\n\r\nconst modal = (props) => {\r\n\r\n\r\n    const modalComponent = (\r\n        <div className='modal'>\r\n            <p className='inputTitle'>Saisissez l'adresse email de l'élève que vous souhaitez inviter</p>\r\n            <p>\r\n                <input type='text' onChange={props.inputChanged}  />\r\n            </p>\r\n            {props.valid? null : <p className='unvalidEmail'>L'adresse email n'est pas valide</p>}\r\n            <p id='unvalid'>\r\n                <button className='btn' id='confirm' onClick={props.sendInvite} >Inviter</button>\r\n                <button className='btn cancel ' id='cancel' onClick={props.closeModal} >Annuler</button>\r\n            </p>\r\n        </div>\r\n    );\r\n    return(\r\n        props.show? modalComponent : null\r\n    );\r\n}\r\n\r\nexport default modal;","import React from 'react';\r\n\r\nimport './backdrop.css';\r\n\r\n\r\n\r\n\r\nconst backdrop = (props) => {\r\n\r\n    const backdropComponent = (\r\n        <div className='backdrop' onClick={props.click}>\r\n        </div>\r\n    );\r\n    return(\r\n        props.show? backdropComponent : null\r\n    );\r\n}\r\n\r\nexport default backdrop;","import React from 'react';\r\nimport './board.css';\r\n\r\nconst board = (props) => {\r\n\r\n    return(\r\n            <div id=\"board\">\r\n                <svg id=\"canvas\" width={props.width} height={props.height} version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <defs id=\"defs\"></defs>\r\n                </svg>\r\n            </div>\r\n    );\r\n\r\n}\r\n\r\nexport default board;\r\n","// External modules\r\nimport React, { Component } from 'react';\r\nimport queryString from 'query-string';\r\n// Config\r\nimport endpoints from '../../assets/config/endpoints.js';\r\n// Scripts\r\nimport boardScript from '../../assets/scripts/board/board';\r\nimport webRTC from '../../assets/scripts/webRTC';\r\n// React components\r\nimport Tools from '../../components/tools/tools';\r\nimport Controls from '../../components/controls/controls';\r\nimport Invite from '../../components/modal/modal';\r\nimport Backdrop from '../../components/backdrop/backdrop';\r\nimport Board from '../../components/board/board';\r\n// Stylesheet\r\nimport './Room.css';\r\n\r\nclass Room extends Component {\r\n\r\n    state = {\r\n        loaded: true,\r\n        boardId: null,\r\n        pin: null,\r\n        socket: null,\r\n        guest: null,\r\n        modal: false,\r\n        initiator: null\r\n    }\r\n    \r\n    componentDidMount() {\r\n        // get URL Params\r\n        const params = queryString.parse(window.location.search);\r\n        const boardId = params.id;\r\n        const pin = params.pin;\r\n        //Connect to room\r\n        const io = require('socket.io-client');\r\n        const socket = io(`${endpoints.prod}boards`);\r\n        \r\n        // Send join request\r\n        if (socket && boardId) {\r\n            // Setup actions if join succeeds OK\r\n            socket.on('joinSuccess', (data) => {\r\n                console.log('joinSuccess');\r\n                this.setState({\r\n                    boardId: boardId,\r\n                    pin: pin,\r\n                    loaded: true,\r\n                    socket: socket\r\n                });\r\n                boardScript(socket, this.state.boardId);\r\n                webRTC(socket, data.boardReady, data.iceServers);\r\n            });\r\n            // Setup actions if join fails\r\n            socket.on('joinFail', error => {\r\n                alert(error);\r\n            });\r\n            console.log('sending join request');\r\n            socket.emit('join', {id: boardId, pin: pin});\r\n        };\r\n    };\r\n    \r\n    componentDidUpdate() {\r\n        if (this.state.loaded && this.state.socket) {\r\n            const socket = this.state.socket;\r\n            socket.on('reconnect', () => {\r\n                socket.emit('joinboard', {room: this.state.boardId, pin: this.state.pin})\r\n            });\r\n        };\r\n    };\r\n\r\n\r\n    sendInvite(){\r\n        const guest = this.state.guest;\r\n        console.log(guest);\r\n        const socket = this.state.socket;\r\n        if(guest && socket){\r\n        socket.emit('inviteGuest', {email: guest});\r\n        socket.on('inviteRes', (res) => {\r\n            console.log('email response:', res);\r\n        });\r\n        } else { \r\n            alert('Il y a eu une erreur, merci de réessayer');\r\n        }\r\n        this.setState({modal: false});\r\n    };\r\n\r\n    guestInputChanged(e){\r\n        const email = e.target.value;\r\n        this.setState({guest: email});\r\n    }\r\n\r\n    toggleModal(){\r\n        const previous = this.state.modal;\r\n        this.setState({\r\n            modal: !previous\r\n        });\r\n    }\r\n\r\n\r\n    render() {\r\n\r\n        let board = null;\r\n        const boardContainer = document.getElementById('boardContainer');\r\n        if (boardContainer){\r\n            board = <Board width='1' height='1' />\r\n        }\r\n        return (\r\n            <div className='globalContainer' id='globalContainer'>\r\n                <Backdrop click={this.toggleModal.bind(this)} show={this.state.modal} />\r\n                <Invite \r\n                    show={this.state.modal}\r\n                    inputChanged={this.guestInputChanged.bind(this)} \r\n                    inputValue={this.state.guest}\r\n                    closeModal={this.toggleModal.bind(this)}\r\n                    sendInvite={this.sendInvite.bind(this)}\r\n                    valid={this.state.validEmail}\r\n                />\r\n                <Tools />\r\n                <div id=\"boardContainer\">\r\n                    {board}\r\n                </div>\r\n                <Controls \r\n                    teacher={this.teacher} \r\n                    student={this.student} \r\n                    openModal={this.toggleModal.bind(this)}\r\n                />\r\n            </div>\r\n        );\r\n    };\r\n};\r\n\r\nexport default Room;\r\n","import React, { Component } from 'react';\nimport './App.css';\nimport {Route} from 'react-router-dom';\n\nimport Start from './views/Start/Start';\nimport Room from './views/Room/Room';\n\nclass App extends Component {\n\n  render() {\n\n    return (\n      <div className=\"App\">\n        <Route path='/' exact component={Start} />\n        <Route path='/boards/' component={Room} />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport {BrowserRouter} from 'react-router-dom';\n\nconst app = (\n    <BrowserRouter >\n        <App/ >\n    </BrowserRouter>\n);\n\nReactDOM.render( app, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();"],"sourceRoot":""}